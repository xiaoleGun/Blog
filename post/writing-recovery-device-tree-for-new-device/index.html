<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree - xiaoleGun&#039;Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="xiaoleGun"><meta name="msapplication-TileImage" content="/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="xiaoleGun"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="è¿™ç¯‡æ•™ç¨‹ä¸­å¯èƒ½æœ‰äº›ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·å„ä½æŒ‡æ­£ã€‚"><meta property="og:type" content="blog"><meta property="og:title" content="ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree"><meta property="og:url" content="https://blog.xiaolegun.cn/post/writing-recovery-device-tree-for-new-device/"><meta property="og:site_name" content="xiaoleGun&#039;Blog"><meta property="og:description" content="è¿™ç¯‡æ•™ç¨‹ä¸­å¯èƒ½æœ‰äº›ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·å„ä½æŒ‡æ­£ã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blog.xiaolegun.cn/img/og_image.png"><meta property="article:published_time" content="2024-02-20T02:46:55.000Z"><meta property="article:modified_time" content="2024-02-20T03:01:52.000Z"><meta property="article:author" content="xiaoleGun"><meta property="article:tag" content="Android"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://blog.xiaolegun.cn/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.xiaolegun.cn/post/writing-recovery-device-tree-for-new-device/"},"headline":"ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree","image":["https://blog.xiaolegun.cn/img/og_image.png"],"datePublished":"2024-02-20T02:46:55.000Z","dateModified":"2024-02-20T03:01:52.000Z","author":{"@type":"Person","name":"xiaoleGun"},"publisher":{"@type":"Organization","name":"xiaoleGun'Blog","logo":{"@type":"ImageObject","url":"https://blog.xiaolegun.cn/img/touxiang.png"}},"description":"è¿™ç¯‡æ•™ç¨‹ä¸­å¯èƒ½æœ‰äº›ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·å„ä½æŒ‡æ­£ã€‚"}</script><link rel="canonical" href="https://blog.xiaolegun.cn/post/writing-recovery-device-tree-for-new-device/"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/touxiang.png" alt="xiaoleGun&#039;Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">ä¸»é¡µ</a><a class="navbar-item" href="/archives">å½’æ¡£</a><a class="navbar-item" href="/categories">åˆ†ç±»</a><a class="navbar-item" href="/tags">æ ‡ç­¾</a><a class="navbar-item" href="/about">å…³äº</a></div><div class="navbar-end"><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-02-20T02:46:55.000Z" title="2024/2/20 10:46:55">2024-02-20</time>å‘è¡¨</span><span class="level-item"><time dateTime="2024-02-20T03:01:52.000Z" title="2024/2/20 11:01:52">2024-02-20</time>æ›´æ–°</span><span class="level-item">1 å°æ—¶è¯»å®Œ (å¤§çº¦10958ä¸ªå­—)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>æ¬¡è®¿é—®</span></div></div><h1 class="title is-3 is-size-4-mobile">ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree</h1><div class="content"><h2 id="ä¸€äº›è‡ªåº"><a href="#ä¸€äº›è‡ªåº" class="headerlink" title="ä¸€äº›è‡ªåº"></a>ä¸€äº›è‡ªåº</h2><p>è¿™ç¯‡æ•™ç¨‹ä¸­å¯èƒ½æœ‰äº›ä¸å¯¹çš„åœ°æ–¹ï¼Œè¯·å„ä½æŒ‡æ­£ï¼Œæˆ‘ä¹Ÿåˆšæ¥è§¦ Android è®¾å¤‡æµ‹å¼€å‘ä¸¤å¹´ï¼Œè€Œä¸”åªæœ‰åœ¨èŠ‚å‡æ—¥çš„æ—¶å€™æœ‰ç©ºä¸€ä¸ªäººçæ£é¼“ï¼Œä¸ºäº†<del>è–… mjw ç¾Šæ¯›</del>ï¼Œæ•…å†™è¿™ç¯‡æ•™ç¨‹ï¼Œè€Œä¸”æˆ‘ä¸ªäººæ›´æ¨è Aosp Recovery åˆ·å†™ç¬¬ä¸‰æ–¹ ROMï¼ŒTWRP å¯èƒ½å¤šå¤šå°‘å°‘æœ‰äº›é—®é¢˜ã€‚Root ä¹‹ç±»çš„ä¸éœ€è¦ TWRP ä¹Ÿå¯ä»¥ï¼Œå¯ä»¥æ‰¾åˆ°åŸæœº boot ä½¿ç”¨ Magisk è¿›è¡Œä¿®è¡¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ KernelSUã€‚å¦å¤–æˆ‘çš„è¯­æ–‡åŠŸåº•ä¸æ˜¯å¾ˆå¥½ï¼Œå†™ä¸å‡ºè¾è—»ï¼Œåªèƒ½æ˜¯åŒ—æ–¹åœ°é“çš„å¤§ç™½è¯ï¼Œè§è°…å“ˆ ğŸ¤£&#x2F;&#x2F;&#x2F;</p>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>1.ä¸€é¢—å‹‡æ•¢çš„ã€ä¸æ€•å›°éš¾çš„å¼ºå¤§å¿ƒè„ã€‚<br><strong><del>ä¸¤é¢—å¿ƒå¥½å‹‡æ•¢ â€“ Falling in love</del></strong> </p>
<p>2.ç”µè„‘é…ç½®:</p>
<table>
<thead>
<tr>
<th>ç¡¬ä»¶</th>
<th>éœ€æ±‚</th>
</tr>
</thead>
<tbody><tr>
<td>CPU</td>
<td>å››æ ¸æˆ–æ›´å¤š</td>
</tr>
<tr>
<td>å†…å­˜</td>
<td>8G æˆ–æ›´å¤š</td>
</tr>
<tr>
<td>ç¡¬ç›˜</td>
<td>è‡³å°‘ 80G ç©ºä½™ç©ºé—´</td>
</tr>
<tr>
<td>ç³»ç»Ÿ</td>
<td>WSL æˆ–å®ä½“ Linuxï¼Œå»ºè®® Debian ç³»</td>
</tr>
</tbody></table>
<p>3.è¶³å¤Ÿçš„ç©ºé—²æ—¶é—´ã€‚</p>
<p>4.Vscode å’Œ ğŸ¤Linux çŸ¥è¯†å‚¨å¤‡ </p>
<p>5.ä¸€å°å®Œå¥½æ— æŸçš„æ–°è®¾å¤‡ã€‚ </p>
<p>6.è®¾å¤‡åŸå‚çš„ boot&#x2F;recovery&#x2F;vendor_boot é•œåƒã€‚(æ¨è recovery åˆ†åŒºï¼Œå› ä¸ºé‡Œé¢åŒ…å«ä¸€äº›å¯åŠ¨å¿…é¡»çš„.rc(run command)ï¼Œå¦‚æœæ²¡æœ‰è¯¥åˆ†åŒºï¼Œå¯»æ‰¾åŒ…å«å®˜æ–¹ recovery å†…å®¹çš„åˆ†åŒºã€‚å€¼å¾—æ³¨æ„çš„æ˜¯éƒ¨åˆ†è®¾å¤‡ recovery åˆå¹¶åˆ°äº† boot ä¸­ï¼Œæˆ–æ˜¯å­˜åœ¨äº vendor_bootï¼‰ </p>
<p>7.æŸ¥çœ‹è‡ªå·±çš„è®¾å¤‡å‡ºå‚ Android ç‰ˆæœ¬å¹¶ç¡®å®šç”¨é€”ï¼Œæ˜¯ç”¨äºå®˜æ–¹ ROM è¿˜æ˜¯ç¬¬ä¸‰æ–¹ç±»åŸç”Ÿã€‚å‡ºå‚ç‰ˆæœ¬ä¸º 9 åŠä»¥ä¸Šçš„å¯ä»¥ä½¿ç”¨ twrp-11 åŠä»¥ä¸Šåˆ†æ”¯ï¼Œ9 ä»¥ä¸‹ä½¿ç”¨ twrp-9 åˆ†æ”¯ã€‚</p>
<h2 id="é…ç½®ç¯å¢ƒ"><a href="#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h2><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt-get install bc bison build-essential ccache curl flex g++-multilib gcc-multilib git gnupg gperf imagemagick lib32ncurses5-dev lib32readline-dev lib32z1-dev liblz4-tool libncurses5 libncurses5-dev libsdl1.2-dev libssl-dev libxml2 libxml2-utils lzop pngcrush rsync schedtool squashfs-tools xsltproc zip zlib1g-dev xattr openjdk-11-jdk jq android-sdk-libsparse-utils python3 python2 repo</span><br></pre></td></tr></table></figure>

<p>å¿…è¦æ—¶å¯ä»¥é˜…è¯»<a target="_blank" rel="noopener" href="https://source.android.com/source/using-repo?hl=zh-cn">Git å’Œ Repo</a></p>
<h3 id="é…ç½®-Git-å’Œ-Repo"><a href="#é…ç½®-Git-å’Œ-Repo" class="headerlink" title="é…ç½® Git å’Œ Repo"></a>é…ç½® Git å’Œ Repo</h3><p>å®‰è£…å®Œä¾èµ–åï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;your username&quot;</span><br><span class="line">git config --global user.email &quot;your email&quot;</span><br></pre></td></tr></table></figure>

<h3 id="åŒæ­¥-TWRP-æºç "><a href="#åŒæ­¥-TWRP-æºç " class="headerlink" title="åŒæ­¥ TWRP æºç "></a>åŒæ­¥ TWRP æºç </h3><p>åœ¨è‡ªå·±æ–¹ä¾¿çš„åœ°æ–¹ï¼Œå»ºç«‹ä¸€ä¸ªç›®å½•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir twrp</span><br><span class="line">cd twrp</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®è‡ªå·±åœ¨å‡†å¤‡å·¥ä½œä¸­ç¡®å®šçš„åˆ†æ”¯åŒæ­¥ç›¸åº”çš„æºç ã€‚</p>
<h4 id="TWRP-9"><a href="#TWRP-9" class="headerlink" title="TWRP-9"></a>TWRP-9</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">repo init --depth=1 -u https://github.com/minimal-manifest-twrp/platform_manifest_twrp_omni.git -b twrp-9.0</span><br><span class="line">repo sync</span><br></pre></td></tr></table></figure>

<h4 id="TWRP-11"><a href="#TWRP-11" class="headerlink" title="TWRP-11"></a>TWRP-11</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">repo init --depth=1 -u https://github.com/minimal-manifest-twrp/platform_manifest_twrp_aosp.git -b twrp-11</span><br><span class="line">repo sync</span><br></pre></td></tr></table></figure>

<h4 id="TWRP-12-1"><a href="#TWRP-12-1" class="headerlink" title="TWRP-12.1"></a>TWRP-12.1</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">repo init --depth=1 -u https://github.com/minimal-manifest-twrp/platform_manifest_twrp_aosp.git -b twrp-12.1</span><br><span class="line">repo sync</span><br></pre></td></tr></table></figure>

<h2 id="ç¼–å†™è®¾å¤‡æ ‘"><a href="#ç¼–å†™è®¾å¤‡æ ‘" class="headerlink" title="ç¼–å†™è®¾å¤‡æ ‘"></a>ç¼–å†™è®¾å¤‡æ ‘</h2><blockquote>
<p>æœ€åŸºæœ¬çš„å¼€æœºéƒ¨åˆ†æˆ‘é€šè¿‡ Redmi K50 åšç¤ºä¾‹ï¼Œå¹¶é€‰å– TWRP-12.1 åˆ†æ”¯ã€‚</p>
</blockquote>
<blockquote>
<p>è§£å¯†éƒ¨åˆ†ä¼šå•ç‹¬æˆä¸€ä¸ªç« èŠ‚å¹¶åˆ†ä¸ºé«˜é€šå’Œè”å‘ç§‘ã€‚</p>
</blockquote>
<h3 id="è·å–èµ„æ–™"><a href="#è·å–èµ„æ–™" class="headerlink" title="è·å–èµ„æ–™"></a>è·å–èµ„æ–™</h3><p>å°ç±³è®¾å¤‡ä¸€èˆ¬å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://xiaomirom.com/">Xiaomirom</a>ä¸­çš„çº¿åˆ·åŒ…è·å– boot&#x2F;recovery&#x2F;vendor_boot é•œåƒï¼Œå…¶å®ƒè®¾å¤‡è¯·è‡ªè¡Œå¯»æ‰¾ã€‚</p>
<h4 id="å®‰è£…å·¥å…·å’Œä¾èµ–"><a href="#å®‰è£…å·¥å…·å’Œä¾èµ–" class="headerlink" title="å®‰è£…å·¥å…·å’Œä¾èµ–"></a>å®‰è£…å·¥å…·å’Œä¾èµ–</h4><p>å°†å‡†å¤‡å·¥ä½œä¸­å‡†å¤‡çš„ boot&#x2F;recovery&#x2F;vendor_boot é•œåƒè§£åŒ…ï¼Œå¯ä»¥ç”¨ä»»ä½•å·¥å…·ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/cfig/Android_boot_image_editor">Android_boot_image_editor</a>æŒ‰ç…§è‡ªè¿°æ–‡ä»¶è¿›è¡Œä¾èµ–å®‰è£…æ“ä½œï¼š</p>
<h5 id="Mac-Intel"><a href="#Mac-Intel" class="headerlink" title="Mac(Intel)"></a>Mac(Intel)</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brew install lz4 xz dtc openjdk@17</span><br><span class="line">echo &#x27;export PATH=&quot;/usr/local/opt/openjdk@17/bin:$PATH&quot;&#x27; &gt;&gt; ~/.zshrc</span><br><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure>

<h5 id="Linux"><a href="#Linux" class="headerlink" title="Linux:"></a>Linux:</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install git device-tree-compiler lz4 xz-utils zlib1g-dev openjdk-17-jdk gcc g++ python3 python-is-python3 p7zip-full android-sdk-libsparse-utils erofs-utils</span><br></pre></td></tr></table></figure>

<h5 id="Common"><a href="#Common" class="headerlink" title="Common:"></a>Common:</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/cfig/Android_boot_image_editor</span><br><span class="line">cd Android_boot_image_editor</span><br></pre></td></tr></table></figure>

<h4 id="è§£åŒ…"><a href="#è§£åŒ…" class="headerlink" title="è§£åŒ…"></a>è§£åŒ…</h4><blockquote>
<p>è¯·æ³¨æ„â€&#x2F;â€œè¡¨ç¤ºæˆ–çš„æ„æ€ï¼Œè¯·ä¸è¦è¯¯ä»¥ä¸ºæ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚</p>
</blockquote>
<blockquote>
<p>å¦‚æœä¸ç¡®å®šåˆ†åŒºå¯»æ‰¾çš„æ˜¯å¦æ­£ç¡®ï¼Œè¯·å°è¯•å°†å¯ä»¥çš„åˆ†åŒºè¿›è¡Œè§£åŒ…ï¼Œå¹¶æŸ¥çœ‹å…¶<code>ramdisk</code>å†…æ˜¯å¦åŒ…å«<code>recovery</code>å­—æ ·çš„æ–‡ä»¶</p>
</blockquote>
<p>å°†ä½ å‡†å¤‡å¥½çš„<code>boot</code>&#x2F;<code>recovery</code>&#x2F;<code>vendor_boot</code>å¤åˆ¶åˆ°è¯¥ç›®å½•ï¼Œä½ å¯ä»¥ä½¿ç”¨ GUI æˆ–è€… CLIã€‚å¦‚:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp &lt;å‡ºå‚boot/recovery/vendor_bootçš„ç»å¯¹è·¯å¾„&gt; boot/recovery/vendor_boot.img</span><br><span class="line">./gradlew unpack</span><br></pre></td></tr></table></figure>

<p>æˆ‘è¿™é‡Œä»¥ Redmi K50 ä¸ºä¾‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">10:12:13.188 [main] INFO  cfig.bootimg.v3.VendorBoot -</span><br><span class="line">                        Unpack Summary of vendor_boot.img</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚What                                   â”‚Where                                 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚image info                             â”‚build/unzip_boot/vendor_boot.json     â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ramdisk                                â”‚build/unzip_boot/ramdisk.img.lz4      â”‚</span><br><span class="line">â”‚-- PLATFORM ramdisk[1/1]               â”‚build/unzip_boot/ramdisk.1.lz4        â”‚</span><br><span class="line">â”‚------- extracted rootfs               â”‚build/unzip_boot/root.1               â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚dtb                                    â”‚build/unzip_boot/dtb                  â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚AVB info                               â”‚build/unzip_boot/vendor_boot.avb.json â”‚</span><br><span class="line">â”‚\-- signing key                        â”‚NONE                                  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">10:12:13.213 [main] WARN  cfig.packable.PackableLauncher - &#x27;unpack&#x27; sequence completed</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL in 2s</span><br></pre></td></tr></table></figure>

<p>è§£åŒ…æˆåŠŸåç»ˆç«¯ä¼šæ‰“å°å‡ºä»¥ä¸Šä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«<code>vendor_boot</code>ç›®å½•ç»“æ„ï¼Œæˆ‘ä»¬åªéœ€è¦<code>ramdisk</code>é‡Œçš„éƒ¨åˆ†å†…å®¹å°±å¥½äº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls build/unzip_boot/root.1 # è¯·æ ¹æ®è‡ªå·±çš„åˆ†åŒºå’Œè®¾å¤‡åˆ¤æ–­ramdiskçš„å‘½åï¼Œä¸€èˆ¬éƒ½ç›´æ¥æ˜¯ramdisk</span><br></pre></td></tr></table></figure>

<p>ä¸å‡ºæ„å¤–çš„è¯ä¼šè¾“å‡ºä»¥ä¸‹å†…å®¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/dump/bootedit î‚° î‚  master ? î‚° ls build/unzip_boot/root.1</span><br><span class="line">acct                         oem</span><br><span class="line">apex                         plat_file_contexts</span><br><span class="line">bin                          plat_property_contexts</span><br><span class="line">bugreports                   postinstall</span><br><span class="line">config                       proc</span><br><span class="line">d                            product</span><br><span class="line">data                         product_file_contexts</span><br><span class="line">data_mirror                  product_property_contexts</span><br><span class="line">debug_ramdisk                prop.default</span><br><span class="line">default.prop                 res</span><br><span class="line">dev                          sdcard</span><br><span class="line">etc                          second_stage_resources</span><br><span class="line">first_stage_ramdisk          sepolicy</span><br><span class="line">init                         storage</span><br><span class="line">init.recovery.hardware.rc    sys</span><br><span class="line">init.recovery.mt6895.rc      system</span><br><span class="line">lib                          system_ext</span><br><span class="line">linkerconfig                 system_ext_file_contexts</span><br><span class="line">miui.factoryreset.fstab      system_ext_property_contexts</span><br><span class="line">miui.factoryreset.rc         tmp</span><br><span class="line">mnt                          vendor</span><br><span class="line">odm                          vendor_dlkm</span><br><span class="line">odm_dlkm                     vendor_file_contexts</span><br><span class="line">odm_file_contexts            vendor_property_contexts</span><br><span class="line">odm_property_contexts</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåŒ…å« init.recovery*çš„å­—æ ·ï¼Œæ­å–œä½ æˆåŠŸæ‰¾åˆ°äº†æ­£ç¡®çš„åˆ†åŒºã€‚å°†è¿™ä¸ªç›®å½•å¤åˆ¶åˆ°ä¸€ä¸ªè‡ªå·±æ–¹ä¾¿çš„åœ°æ–¹ã€‚<br>è‡³æ­¤èµ„æ–™å·²ç»å¤§è‡´é½å…¨äº†ï¼Œè§£å¯†çš„èµ„æ–™ä¼šåœ¨è§£å¯†ç« èŠ‚æ¥è®²è§£å¦‚ä½•è·å–ã€‚</p>
<h3 id="åˆå§‹åŒ–ç›®å½•ç»“æ„"><a href="#åˆå§‹åŒ–ç›®å½•ç»“æ„" class="headerlink" title="åˆå§‹åŒ–ç›®å½•ç»“æ„"></a>åˆå§‹åŒ–ç›®å½•ç»“æ„</h3><p>åœ¨ twrp æºç æ ¹ç›®å½•è¾“å…¥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p device/vendor/codename</span><br><span class="line">mkdir -p device/vendor/codename/recovery/root</span><br><span class="line">cd device/vendor/codename</span><br></pre></td></tr></table></figure>

<p><code>vendor</code>æŒ‡çš„æ˜¯ä¾›åº”å•†ï¼Œå¦‚ xiaomiã€oneplusã€huaweiã€vivoã€realmeã€‚<br><code>codename</code>æŒ‡çš„æ˜¯è®¾å¤‡ä»£å·ï¼Œå°ç±³è®¾å¤‡å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://xiaomirom.com/">Xiaomirom</a>æŸ¥è¯¢ï¼Œå…¶å®ƒè®¾å¤‡è‡ªè¡ŒæŸ¥è¯¢äº¦æˆ–æ˜¯åœ¨å¼€å‘è€…é€‰é¡¹å‹¾é€‰ USB è°ƒè¯•é€šè¿‡ adb å°è¯•è·å–ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb shell getprop ro.product.manufacturer # ä¾›åº”å•†</span><br><span class="line">adb shell getprop ro.product.device # è®¾å¤‡ä»£å·</span><br></pre></td></tr></table></figure>

<p>æˆ‘çš„ Redmi K50 ä¼šæ‰“å°ä»¥ä¸‹ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/dump/bootedit î‚° î‚  master ? î‚° adb shell getprop ro.product.manufacturer</span><br><span class="line">Xiaomi # æ— è®ºæ‰“å°å‡ºæ¥çš„å†…å®¹æ˜¯å¤§å†™è¿˜æ˜¯å°å†™ï¼Œåœ¨ç›®å½•ç»“æ„ä¸­æˆ‘ä»¬éƒ½é‡‡ç”¨å°å†™</span><br><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/dump/bootedit î‚° î‚  master ? î‚° adb shell getprop ro.product.device</span><br><span class="line">rubens</span><br></pre></td></tr></table></figure>

<p>æˆ‘çš„ IQOO NEO5 Lite ä¼šæ‰“å°ä»¥ä¸‹ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° adb shell getprop ro.product.manufacturer</span><br><span class="line">vivo</span><br><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° adb shell getprop ro.product.device</span><br><span class="line">PD2118</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬åªè¦ä¸æ˜¯å±±å¯¨æœºï¼Œå°ä½œåŠå‡ºæ¥çš„æœºå­ï¼Œç”¨è¿™ä¸¤æ¡å‘½ä»¤åº”è¯¥æ˜¯å¯ä»¥æ­£ç¡®è·å–çš„ã€‚</p>
<h3 id="åˆå§‹åŒ–æ„å»ºæ—¶å¿…è¦çš„æ–‡ä»¶"><a href="#åˆå§‹åŒ–æ„å»ºæ—¶å¿…è¦çš„æ–‡ä»¶" class="headerlink" title="åˆå§‹åŒ–æ„å»ºæ—¶å¿…è¦çš„æ–‡ä»¶"></a>åˆå§‹åŒ–æ„å»ºæ—¶å¿…è¦çš„æ–‡ä»¶</h3><p>æ— è®ºæ˜¯ AOSP device tree äº¦æˆ–æ˜¯ TWRP device tree éƒ½åŸºæœ¬ç±»ä¼¼äºä»¥ä¸‹ç»“æ„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/</span><br><span class="line">â”œâ”€â”€ prebuilt           (å­˜æ”¾kernelã€dtbç­‰é¢„ç¼–è¯‘æ–‡ä»¶) # AOSP device treeè‹¥ä½¿ç”¨build kernelåˆ™æ²¡æœ‰è¯¥ç›®å½•</span><br><span class="line">â”œâ”€â”€ recovery/root      (å­˜æ”¾ä¸€äº›.rcå’Œè§£å¯†blobs) # ä¸€èˆ¬ç”¨äºRecovery device tree</span><br><span class="line">â”œâ”€â”€ Android.mk         (Androidæ„å»ºç³»ç»Ÿé¦–å…ˆä¼šæ£€æŸ¥æ¯ä¸ªç›®å½•çš„Android.mkï¼Œé‡Œé¢åŒ…å«ä¸€äº›åˆ¤æ–­ï¼Œç”±å®ƒåŒ…æ‹¬å…¶æ‰€åœ¨ç›®å½•ä¸­æ‰€æœ‰Makefile)</span><br><span class="line">â”œâ”€â”€ AndroidProducts.mk (å£°æ˜äº§å“çš„Makefileå’Œlunchæ—¶å¯ç”¨çš„æ„å»ºç±»å‹)</span><br><span class="line">â”œâ”€â”€ BoardConfig.mk     (æ¿è½½é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸»æ¿å¿…è¦çš„Flag)</span><br><span class="line">â”œâ”€â”€ device.mk          (å£°æ˜è®¾å¤‡æ‰€éœ€çš„æ–‡ä»¶å’Œæ¨¡å—)</span><br><span class="line">â””â”€â”€ &lt;ROM&gt;_codename.mk  (å£°æ˜äº§å“ç‰¹å®šä¿¡æ¯ï¼Œä¾‹å¦‚åç§°ã€å“ç‰Œå’Œå‹å·ï¼Œå¼•ç”¨device.mkç­‰) # ROMå°±æ¯”å¦‚lineageã€arrowç­‰ï¼Œç¼–è¯‘twrpå°±ç›´æ¥å†™twrpï¼Œtwrp-9åˆ†æ”¯è¦å†™onmi</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æŠŠè¿™æ ·çš„ç»“æ„ç§°ä¸ºéª¨æ¶æ ‘(skeleton tree)ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬æŒ‰ç…§ä»¥ä¸Šç»“æ„ä¸ºè‡ªå·±çš„è®¾å¤‡å†™ä¸€ä»½ Recovery device treeã€‚<br>åœ¨ç»ˆç«¯ä½¿ç”¨<code>touch</code>å‘½ä»¤åˆ›å»ºå¿…è¦çš„æ–‡ä»¶ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch Android.mk AndroidProducts.mk BoardConfig.mk device.mk twrp_rubens.mk</span><br><span class="line">ls .</span><br></pre></td></tr></table></figure>

<p>ä¸å‡ºæ„å¤–çš„è¯ä¼šæ‰“å°å‡ºä»¥ä¸‹ä¿¡æ¯</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° touch Android.mk AndroidProducts.mk BoardConfig.mk device.mk twrp_rubens.mk</span><br><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/tmp/device/xiaomi/rubens î‚° ls .</span><br><span class="line">Android.mk         BoardConfig.mk     prebuilt           twrp_rubens.mk</span><br><span class="line">AndroidProducts.mk device.mk          recovery</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä¸‹ä¸€æ­¥äº†~</p>
<h4 id="åˆå§‹-Android-mk-æ–‡ä»¶"><a href="#åˆå§‹-Android-mk-æ–‡ä»¶" class="headerlink" title="åˆå§‹ Android.mk æ–‡ä»¶"></a>åˆå§‹ Android.mk æ–‡ä»¶</h4><p>æ‰“å¼€ Vscode å¹¶æ‰“å¼€è®¾å¤‡æ ‘ç›®å½•ï¼Œä½ è¶³å¤Ÿå¼ºä¹Ÿå¯ä»¥ä½¿ç”¨ nanoã€vim ç¼–è¾‘ã€‚<br>é€‰ä¸­ Android.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH := <span class="variable">$(<span class="built_in">call</span> my-<span class="built_in">dir</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(TARGET_DEVICE)</span>,codename)</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(<span class="built_in">call</span> all-subdir-makefiles,<span class="variable">$(LOCAL_PATH)</span>)</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>codename</code>æ˜¯éœ€è¦ä½ ä¿®æ”¹çš„éƒ¨åˆ†</li>
</ul>
<p>æˆ‘ä¿®æ”¹åæ˜¯è¿™æ ·çš„</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH := <span class="variable">$(<span class="built_in">call</span> my-<span class="built_in">dir</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(TARGET_DEVICE)</span>,rubens)</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(<span class="built_in">call</span> all-subdir-makefiles,<span class="variable">$(LOCAL_PATH)</span>)</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<h4 id="åˆå§‹-AndroidProducts-mk-æ–‡ä»¶"><a href="#åˆå§‹-AndroidProducts-mk-æ–‡ä»¶" class="headerlink" title="åˆå§‹ AndroidProducts.mk æ–‡ä»¶"></a>åˆå§‹ AndroidProducts.mk æ–‡ä»¶</h4><p>é€‰ä¸­ AndroidProducts.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PRODUCT_MAKEFILES := \</span><br><span class="line">    <span class="variable">$(LOCAL_DIR)</span>/&lt;ROM&gt;_&lt;codename&gt;.mk</span><br><span class="line"></span><br><span class="line">COMMON_LUNCH_CHOICES := \</span><br><span class="line">    &lt;ROM&gt;_&lt;codename&gt;-eng</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä¿®æ”¹åæ˜¯è¿™æ ·çš„</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PRODUCT_MAKEFILES := \</span><br><span class="line">    <span class="variable">$(LOCAL_DIR)</span>/twrp_rubens.mk</span><br><span class="line"></span><br><span class="line">COMMON_LUNCH_CHOICES := \</span><br><span class="line">    twrp_rubens-eng</span><br></pre></td></tr></table></figure>

<h4 id="åˆå§‹-BoardConfig-mk-æ–‡ä»¶"><a href="#åˆå§‹-BoardConfig-mk-æ–‡ä»¶" class="headerlink" title="åˆå§‹ BoardConfig.mk æ–‡ä»¶"></a>åˆå§‹ BoardConfig.mk æ–‡ä»¶</h4><blockquote>
<p>å°†ä¹‹å‰å‡†å¤‡çš„<code>ramdisk</code>æ–‡ä»¶å¤¹ç”¨æ–°çª—å£æ‰“å¼€ 1.æ‰¾åˆ°ç›®å½•ä¸‹çš„ prop.default æˆ–å« prop å­—æ ·çš„æ–‡ä»¶ã€‚ä»¥ä¸‹æ³¨é‡Šç±»ä¼¼ ro.*.*çš„å°±æ˜¯ä» prop ä¸­è·å–çš„ 2.è§£åŒ… boot&#x2F;recovery&#x2F;vendor_boot çš„ json<br>ä¾‹å¦‚ build&#x2F;unzip_boot&#x2F;boot.json</p>
</blockquote>
<p>é€‰ä¸­ BoardConfig.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">DEVICE_PATH := device/vendor/codename</span><br><span class="line"></span><br><span class="line"><span class="comment"># Architecture</span></span><br><span class="line">TARGET_ARCH := arm64 <span class="comment"># ro.bionic.arch</span></span><br><span class="line">TARGET_ARCH_VARIANT := armv8-a <span class="comment"># 64ä½é»˜è®¤å˜ä½“</span></span><br><span class="line">TARGET_CPU_ABI := arm64-v8a <span class="comment"># ro.vendor.product.cpu.abilist64 (è‡³å°‘åœ¨å°ç±³è®¾å¤‡ä¸Šæ²¡æœ‰æ‰¾åˆ°ro.product.cpu.abilist)</span></span><br><span class="line">TARGET_CPU_ABI2 := <span class="comment"># 64ä½ç•™ç©º</span></span><br><span class="line">TARGET_CPU_VARIANT := generic <span class="comment"># é»˜è®¤ä¸€èˆ¬éƒ½æ˜¯é€šç”¨</span></span><br><span class="line">TARGET_CPU_VARIANT_RUNTIME := cortex-a55 <span class="comment"># ro.bionic.cpu_variant</span></span><br><span class="line"></span><br><span class="line">TARGET_2ND_ARCH := arm <span class="comment"># ro.bionic.2nd_arch</span></span><br><span class="line">TARGET_2ND_ARCH_VARIANT := <span class="variable">$(TARGET_ARCH_VARIANT)</span></span><br><span class="line">TARGET_2ND_CPU_ABI := armeabi-v7a <span class="comment"># ro.vendor.product.cpu.abilist32ç¬¬ä¸€ä¸ª</span></span><br><span class="line">TARGET_2ND_CPU_ABI2 := armeabi <span class="comment"># ro.vendor.product.cpu.abilist32ç¬¬äºŒä¸ª</span></span><br><span class="line">TARGET_2ND_CPU_VARIANT := <span class="variable">$(TARGET_CPU_VARIANT)</span></span><br><span class="line">TARGET_2ND_CPU_VARIANT_RUNTIME := <span class="variable">$(TARGET_CPU_VARIANT)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Assertation</span></span><br><span class="line">TARGET_OTA_ASSERT_DEVICE := rubens <span class="comment"># codename</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bootloader</span></span><br><span class="line">TARGET_BOOTLOADER_BOARD_NAME := rubens <span class="comment"># ro.product.board</span></span><br><span class="line">TARGET_NO_BOOTLOADER := true</span><br><span class="line">TARGET_USES_UEFI := true</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build Rule</span></span><br><span class="line">ALLOW_MISSING_DEPENDENCIES := true <span class="comment"># ä¸ºäº†recoveryä¸å¥å…¨çš„ä¾èµ–</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kernel - æ³¨é‡Šä¼šè¯´æ˜åœ¨boot/recovery/vendor_boot.jsonä¸­å¯¹åº”çš„å˜é‡</span></span><br><span class="line">BOARD_BOOTIMG_HEADER_VERSION := 4 <span class="comment"># headerVersion</span></span><br><span class="line">BOARD_KERNEL_BASE := 0x3fff8000 <span class="comment"># (kernelLoadAddr - 32KB) qcomè®¾å¤‡baseä¸º0ï¼Œä¸”æ²¡æœ‰åç§»(offset)</span></span><br><span class="line">BOARD_KERNEL_CMDLINE := bootopt=64S3,32N2,64N2 <span class="comment"># cmdline</span></span><br><span class="line">BOARD_KERNEL_PAGESIZE := 4096 <span class="comment"># pageSize</span></span><br><span class="line">BOARD_RAMDISK_OFFSET := 0x26f08000 <span class="comment"># (ramdisk,loadAddr - BOARD_KERNEL_BASE)</span></span><br><span class="line">BOARD_KERNEL_TAGS_OFFSET := 0x07c88000 <span class="comment"># (tagsLoadAddr - BOARD_KERNEL_BASE)</span></span><br><span class="line">BOARD_MKBOOTIMG_ARGS += --header_version <span class="variable">$(BOARD_BOOTIMG_HEADER_VERSION)</span></span><br><span class="line">BOARD_MKBOOTIMG_ARGS += --ramdisk_offset <span class="variable">$(BOARD_RAMDISK_OFFSET)</span></span><br><span class="line">BOARD_MKBOOTIMG_ARGS += --tags_offset <span class="variable">$(BOARD_KERNEL_TAGS_OFFSET)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kernel - prebuilt</span></span><br><span class="line">TARGET_PREBUILT_KERNEL := <span class="variable">$(DEVICE_PATH)</span>/prebuilt/kernel <span class="comment"># é¢„ç¼–è¯‘å†…æ ¸ç›¸å¯¹äºandroidæºç æ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œvendor_bootæœºå‹ä¸éœ€è¦</span></span><br><span class="line">TARGET_PREBUILT_DTB := <span class="variable">$(DEVICE_PATH)</span>/prebuilt/dtb.img <span class="comment"># åŒä¸Š</span></span><br><span class="line">BOARD_MKBOOTIMG_ARGS += --dtb <span class="variable">$(TARGET_PREBUILT_DTB)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Partitions</span></span><br><span class="line">BOARD_FLASH_BLOCK_SIZE := 262144 <span class="comment"># (BOARD_KERNEL_PAGESIZE * 64)</span></span><br><span class="line">BOARD_BOOTIMAGE_PARTITION_SIZE := 67108864 <span class="comment"># boot/recovery/vendor_booté•œåƒçš„å­—èŠ‚å¤§å°éœ€åŸå‚æˆ–æ‰‹æœºå®Œæ•´æå–å‡ºæ¥çš„ï¼Œä¸å®šä¹‰ä¼šæŠ¥é”™</span></span><br><span class="line">BOARD_RECOVERYIMAGE_PARTITION_SIZE := 67108864 <span class="comment"># åŒä¸Š</span></span><br><span class="line">BOARD_VENDOR_ROOTIMAGE_PARTITION_SIZE := 67108864 <span class="comment"># åŒä¸Š</span></span><br><span class="line">BOARD_SYSTEMIMAGE_PARTITION_TYPE := ext4 <span class="comment"># åˆ†åŒºç±»å‹ï¼ŒæŸ¥çœ‹ramdiskä¸­fstabå®šä¹‰çš„ç±»å‹</span></span><br><span class="line">BOARD_USERDATAIMAGE_FILE_SYSTEM_TYPE := ext4</span><br><span class="line">BOARD_VENDORIMAGE_FILE_SYSTEM_TYPE := ext4</span><br><span class="line">TARGET_COPY_OUT_VENDOR := vendor <span class="comment"># å®šä¹‰vendorç›®å½•ï¼Œä¾‹å¦‚copyä¸“æœ‰blobsè¦ç”¨</span></span><br><span class="line">BOARD_SUPER_PARTITION_SIZE := 9126805504 <span class="comment"># å¯ä»¥é€šè¿‡blockdev --getsize64 /dev/block/bootdevice/by-name/superè·å–ï¼Œéœ€rootï¼Œå¦‚æœæ— æ³•rootå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå€¼ï¼Œä¸å½±å“twrpå¯åŠ¨ï¼Œå¯ä»¥åç»­ä¿®æ­£</span></span><br><span class="line">BOARD_SUPER_PARTITION_GROUPS := xiaomi_dynamic_partitions <span class="comment"># xiaomiæ ¹æ®ä½ è·å–èµ„æ–™çš„vendoræ›¿æ¢ï¼Œæ˜¯ä¸€ä¸ªåŠ¨æ€åˆ†åŒºç»„</span></span><br><span class="line">BOARD_XIAOMI_DYNAMIC_PARTITIONS_PARTITION_LIST := system vendor product system_ext odm vendor_dlkm odm_dlkm <span class="comment"># æ ¹æ®fstabå†…çš„å®šä¹‰ï¼Œä¸€èˆ¬flagåŒ…å«logicaléƒ½å±äºåŠ¨æ€åˆ†åŒºç»„çš„ä¸€éƒ¨åˆ†</span></span><br><span class="line">BOARD_XIAOMI_DYNAMIC_PARTITIONS_SIZE := 9122611200 <span class="comment"># (BOARD_SUPER_PARTITION_SIZE - 4MB)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Platform</span></span><br><span class="line">TARGET_BOARD_PLATFORM := mt6895 <span class="comment"># ro.board.platform</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Recovery - åŸºæœ¬é€šç”¨çš„ä¸å½±å“å¯åŠ¨</span></span><br><span class="line">BOARD_HAS_LARGE_FILESYSTEM := true</span><br><span class="line">TARGET_RECOVERY_PIXEL_FORMAT := RGBX_8888</span><br><span class="line">TARGET_USERIMAGES_USE_EXT4 := true</span><br><span class="line">TARGET_USERIMAGES_USE_F2FS := true</span><br><span class="line"></span><br><span class="line"><span class="comment"># Treble</span></span><br><span class="line">BOARD_VNDK_VERSION := current <span class="comment"># å£°æ˜VNDKç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Vendor_boot recovery ramdisk</span></span><br><span class="line">BOARD_MOVE_RECOVERY_RESOURCES_TO_VENDOR_BOOT := true <span class="comment"># å°†recoveryæ–‡ä»¶å¤åˆ¶åˆ°vendor_boot</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Boot recovery ramdisk</span></span><br><span class="line"><span class="comment">#BOARD_USES_RECOVERY_AS_BOOT := true recovery ramdiskåˆå¹¶åœ¨bootä¸­å¯ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Verified Boot</span></span><br><span class="line">BOARD_AVB_ENABLE := true</span><br><span class="line">BOARD_AVB_MAKE_VBMETA_IMAGE_ARGS += --flags 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># TWRP Configurations</span></span><br><span class="line">TW_DEFAULT_LANGUAGE := zh_CN <span class="comment"># é»˜è®¤ä¸ºä¸­æ–‡</span></span><br><span class="line">TW_EXTRA_LANGUAGES := true <span class="comment"># é¢å¤–çš„è¯­è¨€</span></span><br><span class="line">TW_THEME := portrait_hdpi <span class="comment"># ä¸»é¢˜</span></span><br><span class="line">TW_INCLUDE_FASTBOOTD := true <span class="comment"># åŒ…æ‹¬fastbootdï¼Œä¸ºåŠ¨æ€åˆ†åŒº</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¶å®ƒflagè¿˜æœ‰å¾ˆå¤šï¼Œå¯ä»¥åœ¨https://xdaforums.com/t/twrp-flags-for-boardconfig-mk.3333970 æŸ¥æ‰¾ï¼Œ</span></span><br><span class="line"><span class="comment"># è¿™ç¯‡æ–‡ç« ä¹Ÿå¾ˆè€äº†ï¼Œä½†æˆ‘å¹¶ä¸æ¨ètwrpï¼Œæ‰€ä»¥flagæˆ‘ä¹Ÿä¸æ˜¯å¾ˆäº†è§£ï¼Œå¤šç¿»ç¿»github:)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Debug</span></span><br><span class="line">TARGET_USES_LOGD := true <span class="comment"># è°ƒè¯•flag</span></span><br><span class="line">TWRP_INCLUDE_LOGCAT := true</span><br></pre></td></tr></table></figure>

<p>æ— æ³¨é‡Šç‰ˆ</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">DEVICE_PATH := device/vendor/codename</span><br><span class="line"></span><br><span class="line"><span class="comment"># Architecture</span></span><br><span class="line">TARGET_ARCH := arm64</span><br><span class="line">TARGET_ARCH_VARIANT := armv8-a</span><br><span class="line">TARGET_CPU_ABI := arm64-v8a</span><br><span class="line">TARGET_CPU_ABI2 :=</span><br><span class="line">TARGET_CPU_VARIANT := generic</span><br><span class="line">TARGET_CPU_VARIANT_RUNTIME := cortex-a55</span><br><span class="line"></span><br><span class="line">TARGET_2ND_ARCH := arm</span><br><span class="line">TARGET_2ND_ARCH_VARIANT := <span class="variable">$(TARGET_ARCH_VARIANT)</span></span><br><span class="line">TARGET_2ND_CPU_ABI := armeabi-v7a</span><br><span class="line">TARGET_2ND_CPU_ABI2 := armeabi</span><br><span class="line">TARGET_2ND_CPU_VARIANT := <span class="variable">$(TARGET_CPU_VARIANT)</span></span><br><span class="line">TARGET_2ND_CPU_VARIANT_RUNTIME := <span class="variable">$(TARGET_CPU_VARIANT)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Assertation</span></span><br><span class="line">TARGET_OTA_ASSERT_DEVICE := rubens</span><br><span class="line"></span><br><span class="line"><span class="comment"># Bootloader</span></span><br><span class="line">TARGET_BOOTLOADER_BOARD_NAME := rubens</span><br><span class="line">TARGET_NO_BOOTLOADER := true</span><br><span class="line">TARGET_USES_UEFI := true</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build Rule</span></span><br><span class="line">ALLOW_MISSING_DEPENDENCIES := true</span><br><span class="line"></span><br><span class="line"><span class="comment"># Kernel</span></span><br><span class="line">BOARD_BOOT_HEADER_VERSION := 4</span><br><span class="line">BOARD_KERNEL_BASE := 0x3fff8000</span><br><span class="line">BOARD_KERNEL_CMDLINE := bootopt=64S3,32N2,64N2</span><br><span class="line">BOARD_KERNEL_PAGESIZE := 4096</span><br><span class="line">BOARD_RAMDISK_OFFSET := 0x26f08000</span><br><span class="line">BOARD_KERNEL_TAGS_OFFSET := 0x07c88000</span><br><span class="line">BOARD_MKBOOTIMG_ARGS += --header_version <span class="variable">$(BOARD_BOOT_HEADER_VERSION)</span></span><br><span class="line">BOARD_MKBOOTIMG_ARGS += --ramdisk_offset <span class="variable">$(BOARD_RAMDISK_OFFSET)</span></span><br><span class="line">BOARD_MKBOOTIMG_ARGS += --tags_offset <span class="variable">$(BOARD_KERNEL_TAGS_OFFSET)</span></span><br><span class="line">BOARD_KERNEL_IMAGE_NAME := Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># Kernel - prebuilt</span></span><br><span class="line">TARGET_PREBUILT_DTB := <span class="variable">$(DEVICE_PATH)</span>/prebuilt/dtb.img</span><br><span class="line">BOARD_MKBOOTIMG_ARGS += --dtb <span class="variable">$(TARGET_PREBUILT_DTB)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Partitions</span></span><br><span class="line">BOARD_FLASH_BLOCK_SIZE := 262144</span><br><span class="line">BOARD_BOOTIMAGE_PARTITION_SIZE := 67108864</span><br><span class="line">BOARD_RECOVERYIMAGE_PARTITION_SIZE := 67108864</span><br><span class="line">BOARD_VENDOR_ROOTIMAGE_PARTITION_SIZE := 67108864</span><br><span class="line">BOARD_SYSTEMIMAGE_PARTITION_TYPE := ext4</span><br><span class="line">BOARD_USERDATAIMAGE_FILE_SYSTEM_TYPE := ext4</span><br><span class="line">BOARD_VENDORIMAGE_FILE_SYSTEM_TYPE := ext4</span><br><span class="line">TARGET_COPY_OUT_VENDOR := vendor</span><br><span class="line">BOARD_SUPER_PARTITION_SIZE := 9126805504</span><br><span class="line">BOARD_SUPER_PARTITION_GROUPS := xiaomi_dynamic_partitions</span><br><span class="line">BOARD_XIAOMI_DYNAMIC_PARTITIONS_PARTITION_LIST := system vendor product system_ext odm vendor_dlkm odm_dlkm</span><br><span class="line">BOARD_XIAOMI_DYNAMIC_PARTITIONS_SIZE := 9122611200</span><br><span class="line"></span><br><span class="line"><span class="comment"># Platform</span></span><br><span class="line">TARGET_BOARD_PLATFORM := mt6895</span><br><span class="line"></span><br><span class="line"><span class="comment"># Recovery</span></span><br><span class="line">BOARD_HAS_LARGE_FILESYSTEM := true</span><br><span class="line">TARGET_RECOVERY_PIXEL_FORMAT := RGBX_8888</span><br><span class="line">TARGET_USERIMAGES_USE_EXT4 := true</span><br><span class="line">TARGET_USERIMAGES_USE_F2FS := true</span><br><span class="line"></span><br><span class="line"><span class="comment"># Treble</span></span><br><span class="line">BOARD_VNDK_VERSION := current</span><br><span class="line"></span><br><span class="line"><span class="comment"># Vendor_boot recovery ramdisk</span></span><br><span class="line">BOARD_MOVE_RECOVERY_RESOURCES_TO_VENDOR_BOOT := true</span><br><span class="line"></span><br><span class="line"><span class="comment"># Boot recovery ramdisk</span></span><br><span class="line"><span class="comment">#BOARD_USES_RECOVERY_AS_BOOT := true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Verified Boot</span></span><br><span class="line">BOARD_AVB_ENABLE := true</span><br><span class="line">BOARD_AVB_MAKE_VBMETA_IMAGE_ARGS += --flags 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># TWRP Configurations</span></span><br><span class="line">TW_DEFAULT_LANGUAGE := zh_CN</span><br><span class="line">TW_EXTRA_LANGUAGES := true</span><br><span class="line">TW_THEME := portrait_hdpi</span><br><span class="line">TW_INCLUDE_FASTBOOTD := true</span><br><span class="line"></span><br><span class="line"><span class="comment"># Debug</span></span><br><span class="line">TARGET_USES_LOGD := true</span><br><span class="line">TWRP_INCLUDE_LOGCAT := true</span><br></pre></td></tr></table></figure>

<p>è¿™å—å†™äº†å¥½ä¹…æˆ‘ä¹Ÿä¸ç¡®å®šå¯¹ä¸å¯¹ï¼Œè¯·å„ä½æŒ‡æ­£ï¼Œå°¤å…¶æ˜¯ Kernel éƒ¨åˆ†ã€‚</p>
<h4 id="åˆå§‹-device-mk-æ–‡ä»¶"><a href="#åˆå§‹-device-mk-æ–‡ä»¶" class="headerlink" title="åˆå§‹ device.mk æ–‡ä»¶"></a>åˆå§‹ device.mk æ–‡ä»¶</h4><ul>
<li>å‡†å¤‡å¥½ prop.default</li>
</ul>
<p>é€‰ä¸­ AndroidProducts.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">DEVICE_PATH := device/xiaomi/rubens</span><br><span class="line"></span><br><span class="line"><span class="comment"># API</span></span><br><span class="line">PRODUCT_SHIPPING_API_LEVEL := 31 <span class="comment"># ro.board.first_api_level</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A/B</span></span><br><span class="line">AB_OTA_UPDATER := true <span class="comment"># å¯ç”¨A/Bæ— ç¼æ›´æ–°</span></span><br><span class="line">AB_OTA_PARTITIONS += \ <span class="comment"># å®šä¹‰A/Båˆ†åŒºï¼Œå‚è€ƒfstab</span></span><br><span class="line">    boot \</span><br><span class="line">    dtbo \</span><br><span class="line">    system \</span><br><span class="line">    product \</span><br><span class="line">    vendor \</span><br><span class="line">    odm \</span><br><span class="line">    odm_dlkm \</span><br><span class="line">    vbmeta \</span><br><span class="line">    vendor_boot \</span><br><span class="line">    vendor_dlkm \</span><br><span class="line">    vbmeta_system \</span><br><span class="line">    vbmeta_vendor</span><br><span class="line"></span><br><span class="line">PRODUCT_PACKAGES += \</span><br><span class="line">    update_engine \</span><br><span class="line">    update_engine_sideload \</span><br><span class="line">    update_verifier \</span><br><span class="line">    checkpoint_gc</span><br><span class="line"></span><br><span class="line">AB_OTA_POSTINSTALL_CONFIG += \</span><br><span class="line">    RUN_POSTINSTALL_system=true \</span><br><span class="line">    POSTINSTALL_PATH_system=system/bin/mtk_plpath_utils \</span><br><span class="line">    FILESYSTEM_TYPE_system=ext4 \</span><br><span class="line">    POSTINSTALL_OPTIONAL_system=true</span><br><span class="line"></span><br><span class="line">AB_OTA_POSTINSTALL_CONFIG += \</span><br><span class="line">    RUN_POSTINSTALL_vendor=true \</span><br><span class="line">    POSTINSTALL_PATH_vendor=bin/checkpoint_gc \</span><br><span class="line">    FILESYSTEM_TYPE_vendor=ext4 \</span><br><span class="line">    POSTINSTALL_OPTIONAL_vendor=true</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dynamic</span></span><br><span class="line">PRODUCT_USE_DYNAMIC_PARTITIONS := true <span class="comment"># åŠ¨æ€åˆ†åŒº</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Soong namespaces</span></span><br><span class="line">PRODUCT_SOONG_NAMESPACES += <span class="variable">$(DEVICE_PATH)</span> <span class="comment"># å‘½åç©ºé—´</span></span><br></pre></td></tr></table></figure>

<ul>
<li>A&#x2F;B æ— ç¼æ›´æ–°éƒ¨åˆ†é«˜é€šå’Œè”å‘ç§‘ä¸ä¸€æ ·ï¼Œè”å‘ç§‘è®¾å¤‡å¯ä»¥ç…§æŠ„ï¼Œæ³¨æ„ system&#x2F;bin&#x2F;mtk_plpath_utils å°±å¥½ã€‚é«˜é€šå‚è€ƒ<a target="_blank" rel="noopener" href="https://github.com/sekaiacg/android_device_xiaomi_venus_TWRP/tree/android-13">venus twrp tree</a>ï¼Œå¹¶ä¸”é«˜é€šçš„<a target="_blank" rel="noopener" href="https://git.codelinaro.org/clo/la/platform/hardware/qcom/bootctrl">bootctrl</a>å’Œ<a target="_blank" rel="noopener" href="https://git.codelinaro.org/clo/la/platform/vendor/qcom-opensource/recovery-ext">gpt-utils</a>å¯ä»¥ä» CLO æ‹¿ã€‚</li>
</ul>
<p>æ— æ³¨é‡Šç‰ˆ</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">PRODUCT_SHIPPING_API_LEVEL := 31</span><br><span class="line"></span><br><span class="line"><span class="comment"># A/B</span></span><br><span class="line">AB_OTA_UPDATER := true</span><br><span class="line">AB_OTA_PARTITIONS += \</span><br><span class="line">    boot \</span><br><span class="line">    dtbo \</span><br><span class="line">    system \</span><br><span class="line">    product \</span><br><span class="line">    vendor \</span><br><span class="line">    odm \</span><br><span class="line">    odm_dlkm \</span><br><span class="line">    vbmeta \</span><br><span class="line">    vendor_boot \</span><br><span class="line">    vendor_dlkm \</span><br><span class="line">    vbmeta_system \</span><br><span class="line">    vbmeta_vendor</span><br><span class="line"></span><br><span class="line">PRODUCT_PACKAGES += \</span><br><span class="line">    update_engine \</span><br><span class="line">    update_engine_sideload \</span><br><span class="line">    update_verifier \</span><br><span class="line">    checkpoint_gc</span><br><span class="line"></span><br><span class="line">AB_OTA_POSTINSTALL_CONFIG += \</span><br><span class="line">    RUN_POSTINSTALL_system=true \</span><br><span class="line">    POSTINSTALL_PATH_system=system/bin/mtk_plpath_utils \</span><br><span class="line">    FILESYSTEM_TYPE_system=ext4 \</span><br><span class="line">    POSTINSTALL_OPTIONAL_system=true</span><br><span class="line"></span><br><span class="line">AB_OTA_POSTINSTALL_CONFIG += \</span><br><span class="line">    RUN_POSTINSTALL_vendor=true \</span><br><span class="line">    POSTINSTALL_PATH_vendor=bin/checkpoint_gc \</span><br><span class="line">    FILESYSTEM_TYPE_vendor=ext4 \</span><br><span class="line">    POSTINSTALL_OPTIONAL_vendor=true</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dynamic</span></span><br><span class="line">PRODUCT_USE_DYNAMIC_PARTITIONS := true</span><br><span class="line"></span><br><span class="line"><span class="comment"># Soong namespaces</span></span><br><span class="line">PRODUCT_SOONG_NAMESPACES += <span class="variable">$(DEVICE_PATH)</span></span><br></pre></td></tr></table></figure>

<h4 id="åˆå§‹-twrp-rubens-mk-æ–‡ä»¶"><a href="#åˆå§‹-twrp-rubens-mk-æ–‡ä»¶" class="headerlink" title="åˆå§‹ twrp_rubens.mk æ–‡ä»¶"></a>åˆå§‹ twrp_rubens.mk æ–‡ä»¶</h4><p>é€‰ä¸­ AndroidProducts.mk å¹¶æŒ‰ç…§è‡ªå·±çš„èµ„æ–™å¤åˆ¶å¹¶æ›´æ”¹ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inherit from common AOSP config</span></span><br><span class="line"><span class="variable">$(<span class="built_in">call</span> inherit-product, <span class="variable">$(SRC_TARGET_DIR)</span>/product/base.mk)</span></span><br><span class="line"><span class="variable">$(<span class="built_in">call</span> inherit-product, <span class="variable">$(SRC_TARGET_DIR)</span>/product/core_64_bit_only.mk)</span></span><br><span class="line"><span class="variable">$(<span class="built_in">call</span> inherit-product, <span class="variable">$(SRC_TARGET_DIR)</span>/product/virtual_ab_ota/launch_with_vendor_ramdisk.mk)</span> <span class="comment"># vabåŠ è½½åˆ°vendor booté‡Œä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Inherit from TWRP product configuration</span></span><br><span class="line"><span class="variable">$(<span class="built_in">call</span> inherit-product, vendor/twrp/config/common.mk)</span> <span class="comment"># twrp-9åˆ†æ”¯æ”¹ä¸ºonmi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Device specific configs</span></span><br><span class="line"><span class="variable">$(<span class="built_in">call</span> inherit-product, device/xiaomi/rubens/device.mk)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Device identifier</span></span><br><span class="line">PRODUCT_DEVICE := rubens <span class="comment"># è®¾å¤‡å‹å·</span></span><br><span class="line">PRODUCT_NAME := twrp_rubens <span class="comment"># è®¾å¤‡åç§°</span></span><br><span class="line">PRODUCT_BRAND := Redmi <span class="comment"># è‡ªå®šä¹‰å“ç‰Œï¼Œå¦‚æœæœ‰</span></span><br><span class="line">PRODUCT_MODEL := 22041211AC <span class="comment"># äº§å“æœ€ç»ˆç”¨æˆ·å¯è§åç§°</span></span><br><span class="line">PRODUCT_MANUFACTURER := Xiaomi <span class="comment"># åˆ¶é€ å•†</span></span><br><span class="line"></span><br><span class="line">PRODUCT_PROPERTY_OVERRIDES += ro.twrp.vendor_boot=true <span class="comment"># å¯¹twrpå¯åŠ¨vendor_bootæ”¯æŒ</span></span><br></pre></td></tr></table></figure>

<p>æ— æ³¨é‡Šç‰ˆ</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inherit from common AOSP config</span></span><br><span class="line"><span class="variable">$(<span class="built_in">call</span> inherit-product, <span class="variable">$(SRC_TARGET_DIR)</span>/product/base.mk)</span></span><br><span class="line"><span class="variable">$(<span class="built_in">call</span> inherit-product, <span class="variable">$(SRC_TARGET_DIR)</span>/product/core_64_bit_only.mk)</span></span><br><span class="line"><span class="variable">$(<span class="built_in">call</span> inherit-product, <span class="variable">$(SRC_TARGET_DIR)</span>/product/virtual_ab_ota/launch_with_vendor_ramdisk.mk)</span> <span class="comment"># vabåŠ è½½åˆ°vendor booté‡Œä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Inherit from TWRP product configuration</span></span><br><span class="line"><span class="variable">$(<span class="built_in">call</span> inherit-product, vendor/twrp/config/common.mk)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Device specific configs</span></span><br><span class="line"><span class="variable">$(<span class="built_in">call</span> inherit-product, device/xiaomi/rubens/device.mk)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Device identifier</span></span><br><span class="line">PRODUCT_DEVICE := rubens</span><br><span class="line">PRODUCT_NAME := twrp_rubens</span><br><span class="line">PRODUCT_BRAND := Redmi</span><br><span class="line">PRODUCT_MODEL := 22041211AC</span><br><span class="line">PRODUCT_MANUFACTURER := Xiaomi</span><br><span class="line"></span><br><span class="line">PRODUCT_PROPERTY_OVERRIDES += ro.twrp.vendor_boot=true</span><br></pre></td></tr></table></figure>

<h4 id="åˆå§‹-recovery-ç›®å½•"><a href="#åˆå§‹-recovery-ç›®å½•" class="headerlink" title="åˆå§‹ recovery ç›®å½•"></a>åˆå§‹ recovery ç›®å½•</h4><blockquote>
<p>æ‹¿å‡ºæˆ‘ä»¬å¥½ä¹…ä¹‹å‰å‡†å¤‡çš„ ramdisk å­</p>
</blockquote>
<p>é€šè¿‡<code>tree</code>å‘½ä»¤æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ ramdisk çš„æ ‘çŠ¶å›¾ï¼Œå¯ä»¥å¾ˆæ¸…æ™°çš„æŸ¥çœ‹åŒ…å«çš„æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ acct</span><br><span class="line">â”œâ”€â”€ apex</span><br><span class="line">â”œâ”€â”€ bin -&gt; /system/bin</span><br><span class="line">â”œâ”€â”€ bugreports -&gt; /data/user_de/0/com.android.shell/files/bugreports</span><br><span class="line">â”œâ”€â”€ config</span><br><span class="line">â”œâ”€â”€ d -&gt; /sys/kernel/debug</span><br><span class="line">â”œâ”€â”€ data</span><br><span class="line">â”œâ”€â”€ data_mirror</span><br><span class="line">â”œâ”€â”€ debug_ramdisk</span><br><span class="line">â”œâ”€â”€ default.prop -&gt; prop.default</span><br><span class="line">â”œâ”€â”€ dev</span><br><span class="line">â”œâ”€â”€ etc -&gt; /system/etc</span><br><span class="line">â”œâ”€â”€ first_stage_ramdisk</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ fstab.emmc</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ fstab.mt6895</span><br><span class="line">â”‚Â Â  â””â”€â”€ system</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ e2fsck</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ linker64</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ linker_asan64 -&gt; linker64</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ snapuserd</span><br><span class="line">â”‚Â Â      â””â”€â”€ lib64</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ ld-android.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libbase.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libc++.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libc.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libdl.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libext2_blkid.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libext2_com_err.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libext2_e2p.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libext2_quota.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libext2_uuid.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libext2fs.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ liblog.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libm.so</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ libsparse.so</span><br><span class="line">â”‚Â Â          â””â”€â”€ libz.so</span><br><span class="line">â”œâ”€â”€ init -&gt; /system/bin/init</span><br><span class="line">â”œâ”€â”€ init.recovery.hardware.rc</span><br><span class="line">â”œâ”€â”€ init.recovery.mt6895.rc</span><br><span class="line">â””â”€â”€ ç­‰ç­‰ç­‰ç­‰...çœç•¥å¤§æ¦‚1000ä¸ªæ–‡ä»¶å§</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å› ä¸ºé¿å…æ•™ç¨‹æ—¶æ•ˆæ€§ï¼Œæˆ‘ä»¬å°½å¯èƒ½é€‰å– prebuilt çš„åŠæ³•ï¼Œå¦‚ boot å’Œ mtk_plpath_utils éƒ½é‡‡ç”¨é¢„ç¼–è¯‘ã€‚</p>
</blockquote>
<p>é‡Œé¢æœ‰å¾ˆå¤šæ–‡ä»¶æ˜¯æ²¡ç”¨çš„ï¼Œæ•´ç†ä¸€ä¸‹ï¼Œå¯¹æˆ‘ä»¬æœ‰ç”¨çš„åªæœ‰è¿™äº›</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ first_stage_ramdisk</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ fstab.emmc</span><br><span class="line">â”‚Â Â  â””â”€â”€ fstab.mt6895</span><br><span class="line">â”œâ”€â”€ init.recovery.mt6895.rc</span><br><span class="line">â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â””â”€â”€ modules</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ 8250_mtk.ko</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ adapter_class.ko</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ adsp.ko</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ aee_aed.ko</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ aee_hangdet.ko</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ aee_rs.ko</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ blocktag.ko</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bootprof.ko</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ bq28z610.ko</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ cache-parity.ko</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ cfg80211.ko</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ charger_class.ko</span><br><span class="line">â”‚Â Â      â””â”€â”€ çœç•¥ä¸€ç™¾å¤šä¸ªæ¨¡å—ï¼Œè¿™ä¸ªç›®å½•é‡Œçš„ä¸œè¥¿å…¨è¦</span><br><span class="line">â””â”€â”€ system</span><br><span class="line">    â”œâ”€â”€ bin</span><br><span class="line">    â”‚Â Â  â””â”€â”€ mtk_plpath_utils</span><br><span class="line">    â”œâ”€â”€ etc</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ init</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â”‚â”€â”€ mtk-plpath-utils.rc</span><br><span class="line">    â”‚   â”‚   â””â”€â”€hw</span><br><span class="line">    â”‚   â”‚      â””â”€â”€init.rc</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ recovery.fstab</span><br><span class="line">    â”‚Â Â  â”œâ”€â”€ security</span><br><span class="line">    â”‚Â Â  â”‚Â Â  â””â”€â”€ otacerts.zip</span><br><span class="line">    â”‚Â Â  â””â”€â”€ ueventd.rc</span><br><span class="line">    â””â”€â”€ lib64</span><br><span class="line">        â””â”€â”€ hw</span><br><span class="line">            â””â”€â”€ android.hardware.boot@1.0-impl-1.2-mtkimpl.so</span><br></pre></td></tr></table></figure>

<p>å°†å®ƒä»¬æŒ‰ç…§ä»¥ä¸‹æ“ä½œå¤åˆ¶</p>
<ul>
<li>first_stage_ramdisk â€“&gt; recovery&#x2F;root&#x2F;first_stage_ramdisk</li>
<li>init.recovery.mt6895.rc â€“&gt; recovery&#x2F;root&#x2F;init.recovery.mt6895.rc</li>
<li>lib â€“&gt; recovery&#x2F;root&#x2F;lib</li>
<li>system â€“&gt; recovery&#x2F;root&#x2F;system (security å’Œ hw æ–‡ä»¶å¤¹é‡Œçš„å†…å®¹ä½œä¸ºå¤‡ç”¨ï¼Œä¸è¦å¤åˆ¶è¿›å»)<br>å¾—åˆ°ä»¥ä¸‹ç›®å½•ç»“æ„</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ Android.mk</span><br><span class="line">â”œâ”€â”€ AndroidProducts.mk</span><br><span class="line">â”œâ”€â”€ BoardConfig.mk</span><br><span class="line">â”œâ”€â”€ device.mk</span><br><span class="line">â”œâ”€â”€ prebuilt</span><br><span class="line">â”œâ”€â”€ recovery</span><br><span class="line">â”‚Â Â  â””â”€â”€ root</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ first_stage_ramdisk</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ fstab.emmc</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ fstab.mt6895</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ init.recovery.mt6895.rc</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ modules</span><br><span class="line">â”‚Â Â      â”‚Â Â      â”œâ”€â”€ 8250_mtk.ko</span><br><span class="line">â”‚Â Â      â”‚Â Â      â”œâ”€â”€ adapter_class.ko</span><br><span class="line">â”‚Â Â      â”‚Â Â      â”œâ”€â”€ adsp.ko</span><br><span class="line">â”‚Â Â      â”‚Â Â      â”œâ”€â”€ aee_aed.ko</span><br><span class="line">â”‚Â Â      â”‚Â Â      â”œâ”€â”€ aee_hangdet.ko</span><br><span class="line">â”‚Â Â      â”‚Â Â      â”œâ”€â”€ aee_rs.ko</span><br><span class="line">â”‚Â Â      â”‚Â Â      â”œâ”€â”€ blocktag.ko</span><br><span class="line">â”‚Â Â      â”‚Â Â      â””â”€â”€ çœç•¥....</span><br><span class="line">â”‚Â Â      â””â”€â”€ system</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â          â”‚Â Â  â””â”€â”€ mtk_plpath_utils</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ etc</span><br><span class="line">â”‚Â Â          â”‚Â Â  â”œâ”€â”€ recovery.fstab</span><br><span class="line">â”‚Â Â          â”‚Â Â  â””â”€â”€ ueventd.rc</span><br><span class="line">â”‚Â Â          â””â”€â”€ lib64</span><br><span class="line">â”‚Â Â              â””â”€â”€ hw</span><br><span class="line">â”‚Â Â                  â””â”€â”€ android.hardware.boot@1.0-impl-1.2-mtkimpl.so</span><br><span class="line">â””â”€â”€ twrp_rubens.mk</span><br></pre></td></tr></table></figure>

<p>æ‰“å¼€ init.recovery.mt6895.rc æ·»åŠ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">on boot</span><br><span class="line">    start health-hal-2-1</span><br><span class="line"></span><br><span class="line">on post-fs</span><br><span class="line">    start boot-hal-1-2</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">on post-fs</span><br><span class="line">    start boot-hal-1-2</span><br><span class="line"></span><br><span class="line">on init</span><br><span class="line">    setprop sys.usb.configfs 1</span><br><span class="line">    setprop sys.usb.controller &quot;11201000.usb0&quot;</span><br><span class="line">    setprop sys.usb.ffs.aio_compat 1</span><br><span class="line"></span><br><span class="line">on fs &amp;&amp; property:ro.debuggable=0</span><br><span class="line">    # distinguish USB shoulde connect or not, i.e. CDP vs SDP</span><br><span class="line">    # set charging free due to it wait for USB activation</span><br><span class="line"></span><br><span class="line">on boot</span><br><span class="line">    start health-hal-2-1</span><br><span class="line">    exec u:r:update_engine:s0 root root -- /system/bin/mtk_plpath_utils</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å¯ä»¥å¼€å§‹ç¼–è¯‘å’¯~~</p>
<h4 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h4><blockquote>
<p>ç¼–è¯‘å‰è¯·æ£€æŸ¥æ³¨é‡Šæ˜¯å¦å…¨éƒ¨åˆ é™¤</p>
</blockquote>
<p>twrp æºç æ ¹ç›®å½•æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">. build/envsetup.sh</span><br><span class="line">lunch twrp_codename-eng # twrp-9ä¸ºonmi</span><br><span class="line">mka vendorbootimg/bootimage/recoveryimage</span><br></pre></td></tr></table></figure>

<p>ä¸å‡ºæ„å¤–çš„è¯ä¸€è·¯ç»¿ç¯ï¼Œå¦‚æœæœ‰æŠ¥é”™çš„è¯è¯·å‘é‚®ç®±è‡³ <a href="mailto:&#49;&#x35;&#x39;&#50;&#x35;&#x30;&#49;&#54;&#48;&#53;&#64;&#113;&#113;&#46;&#99;&#111;&#109;">&#49;&#x35;&#x39;&#50;&#x35;&#x30;&#49;&#54;&#48;&#53;&#64;&#113;&#113;&#46;&#99;&#111;&#109;</a> å’¨è¯¢æˆ‘</p>
<p>äº§ç‰©åœ¨ <code>out/target/product/codename/vendor_boot.img\boot.img\recovery.img</code><br>æ‰‹æœºé‡å¯åˆ° fastboot æ¨¡å¼ï¼Œä½¿ç”¨ fastboot flash åˆ·å†™ï¼Œä¾‹å¦‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot flash vendor_boot /Users/xiaolegun/Downloads/vendor_boot.img</span><br></pre></td></tr></table></figure>

<p>åˆ™è¾“å‡º</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ERROR: could not clear input pipe; result e0005000, ignoring...</span><br><span class="line">ERROR: could not clear output pipe; result e0005000, ignoring....</span><br><span class="line">Sending &#x27;vendor_boot_a&#x27; (65536 KB)                 OKAY [  1.396s]</span><br><span class="line">Writing &#x27;vendor_boot_a&#x27;                            OKAY [  0.167s]</span><br><span class="line">Finished. Total time: 1.625s</span><br></pre></td></tr></table></figure>

<p>å°±å¯ä»¥é‡å¯æŒ‰ç”µæºåŠ éŸ³é‡ä¸Šå°è¯•äº†ï¼Œæˆ‘è‡ªå·±æ˜¯ä¸€æ¬¡ç‚¹äº®ï¼Œä½†æœ‰ bugã€‚</p>
<h4 id="ä¿®-BUG"><a href="#ä¿®-BUG" class="headerlink" title="ä¿® BUG"></a>ä¿® BUG</h4><h5 id="ä¿®å¤-USB"><a href="#ä¿®å¤-USB" class="headerlink" title="ä¿®å¤ USB"></a>ä¿®å¤ USB</h5><p>æˆ‘çœ‹åˆ° twrp æ§åˆ¶å°æœ‰å¾ˆå¤šæŠ¥é”™ï¼Œç¬¬ä¸€æ­¥è‚¯å®šæ˜¯å…ˆè·å–æ—¥å¿—ï¼Œä½¿ç”¨<code>logcat</code>å‘½ä»¤è·å–ï¼Œåœ¨æ­¤ä¹‹å‰å…ˆä½¿ç”¨<code>adb devices</code>æ£€æµ‹ä¸€ä¸‹è®¾å¤‡ usb æ˜¯å¦å·¥ä½œæ­£å¸¸ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~ î‚° adb devices         î‚² âœ” î‚² 10208 î‚² 10:05:31</span><br><span class="line">* daemon not running; starting now at tcp:5037</span><br><span class="line">* daemon started successfully</span><br><span class="line">List of devices attached</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<code>adb</code>æ²¡æœ‰æ£€æµ‹åˆ°è®¾å¤‡ï¼ŒåŸå› ä¸€èˆ¬æ˜¯ usb çš„é…ç½®ä¸å¯¹ï¼Œä½† usb æ˜¯å¥½çš„ã€‚è¿™æ—¶å¯ä»¥å°è¯•å…³é—­ mtpï¼Œå†å¼€å¯ï¼Œå¦‚æœç”µè„‘æœ‰ååº”ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»§ç»­ä¸‹ä¸€æ­¥äº†ã€‚<br>åœ¨è®¾å¤‡æ ‘ä¸­çš„ recovery&#x2F;rootï¼Œåˆ›å»º init.recovery.usb.rc çš„æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch recovery/root/init.recovery.usb.rc</span><br></pre></td></tr></table></figure>

<p>å¹¶å¯¼å…¥ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">on property:sys.usb.config=mtp,adb</span><br><span class="line">    start adbd</span><br><span class="line"></span><br><span class="line">on property:sys.usb.ffs.ready=1 &amp;&amp; property:sys.usb.config=mtp,adb</span><br><span class="line">    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration &quot;mtp_adb&quot;</span><br><span class="line">    rm /config/usb_gadget/g1/configs/b.1/f1</span><br><span class="line">    rm /config/usb_gadget/g1/configs/b.1/f2</span><br><span class="line">    rm /config/usb_gadget/g1/configs/b.1/f3</span><br><span class="line">    rm /config/usb_gadget/g1/configs/b.1/f4</span><br><span class="line">    rm /config/usb_gadget/g1/configs/b.1/f5</span><br><span class="line">    write /config/usb_gadget/g1/idVendor 0x18d1</span><br><span class="line">    write /config/usb_gadget/g1/idProduct 0x2d08</span><br><span class="line">    symlink /config/usb_gadget/g1/functions/mtp.gs0 /config/usb_gadget/g1/configs/b.1/f1</span><br><span class="line">    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2</span><br><span class="line">    write /config/usb_gadget/g1/UDC $&#123;sys.usb.controller&#125;</span><br><span class="line">    setprop sys.usb.state $&#123;sys.usb.config&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯æˆ‘ä»æˆ‘ç»´æŠ¤çš„ MI 6X çš„ device tree æ‹¿è¿‡æ¥çš„ï¼Œå¯ä»¥åœ¨è”å‘ç§‘è®¾å¤‡ä¸Šæ­£å¸¸å·¥ä½œã€‚è¿™æ®µ shell çš„å¤§è‡´æ„æ€å°±æ˜¯åœ¨ usb é…ç½®èŠ‚ç‚¹å†™å…¥ mtp å’Œ adb åŒæ—¶å·¥ä½œçš„å­—ç¬¦ä¸²ï¼Œè¿™æ · adb å°±èƒ½é¡ºåˆ©å·¥ä½œäº†ã€‚</p>
<p>æ­¤å¤–æ‰“å¼€åŸå‚ init.rc ä¿®æ­£ä¸€ä¸‹ usb è®¾å¤‡çš„ id</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MIUI ADD: START</span></span><br><span class="line">import /init.recovery.hardware.rc</span><br><span class="line">import /miui.factoryreset.rc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">END</span></span><br><span class="line">import /init.recovery.$&#123;ro.hardware&#125;.rc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">########## çœç•¥ä¸€ä¸‡å­—</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MIUI ADD: START</span></span><br><span class="line">on property:sys.usb.config=mtp,adb &amp;&amp; property:sys.usb.configfs=0</span><br><span class="line">    write /sys/class/android_usb/android0/enable 0</span><br><span class="line">    write /sys/class/android_usb/android0/idVendor 2717</span><br><span class="line">    write /sys/class/android_usb/android0/idProduct 904D</span><br><span class="line">    write /sys/class/android_usb/android0/functions mtp,adb</span><br><span class="line">    write /sys/class/android_usb/android0/enable 1</span><br><span class="line">    setprop sys.usb.state  $&#123;sys.usb.config&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">END</span></span><br></pre></td></tr></table></figure>

<p>å°†<code>/sys/class/android_usb/android0/idVendor</code>å’Œ<code>write /sys/class/android_usb/android0/idProduct</code>åé¢çš„ id åˆ†åˆ«æ›¿æ¢åˆ°<code>/config/usb_gadget/g1/idVendor</code>å’Œ<code>/config/usb_gadget/g1/idProduct</code>å¤„ç†å®Œå°±æ˜¯è¿™æ ·çš„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">on property:sys.usb.config=mtp,adb</span><br><span class="line">    start adbd</span><br><span class="line"></span><br><span class="line">on property:sys.usb.ffs.ready=1 &amp;&amp; property:sys.usb.config=mtp,adb</span><br><span class="line">    write /config/usb_gadget/g1/configs/b.1/strings/0x409/configuration &quot;mtp_adb&quot;</span><br><span class="line">    rm /config/usb_gadget/g1/configs/b.1/f1</span><br><span class="line">    rm /config/usb_gadget/g1/configs/b.1/f2</span><br><span class="line">    rm /config/usb_gadget/g1/configs/b.1/f3</span><br><span class="line">    rm /config/usb_gadget/g1/configs/b.1/f4</span><br><span class="line">    rm /config/usb_gadget/g1/configs/b.1/f5</span><br><span class="line">    write /config/usb_gadget/g1/idVendor 0x2717</span><br><span class="line">    write /config/usb_gadget/g1/idProduct 0x904D</span><br><span class="line">    symlink /config/usb_gadget/g1/functions/mtp.gs0 /config/usb_gadget/g1/configs/b.1/f1</span><br><span class="line">    symlink /config/usb_gadget/g1/functions/ffs.adb /config/usb_gadget/g1/configs/b.1/f2</span><br><span class="line">    write /config/usb_gadget/g1/UDC $&#123;sys.usb.controller&#125;</span><br><span class="line">    setprop sys.usb.state $&#123;sys.usb.config&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å¼€æœºä¹‹å adb å’Œ mtp å°±èƒ½åŒæ—¶å·¥ä½œäº†ã€‚</p>
<h5 id="ä¿®å¤-Resetprop"><a href="#ä¿®å¤-Resetprop" class="headerlink" title="ä¿®å¤ Resetprop"></a>ä¿®å¤ Resetprop</h5><p>æ¥ä¸‹æ¥å°±å¯ä»¥ä¿®å¤å…¶å®ƒ bug äº†ï¼Œæˆ‘çœ‹åˆ°æ§åˆ¶å°æœ‰ä¸€å †çº¢è‰²çš„æŠ¥é”™:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">E:Unknown File System:&#x27;/mi_ext&#x27;</span><br><span class="line">E:Unable to override &#x27;external_storage.projid.enabled&#x27; due to missing libresetprop</span><br><span class="line">æŒ‚è½½â€œ/dataâ€å¤±è´¥(Invalid argument)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸‰ä¸ªæŠ¥é”™ä¸­ç¬¬äºŒä¸ªæœ€å¥½ä¿®ï¼Œç¬¬ä¸€ä¸ªæ¬¡ä¹‹ï¼Œç¬¬ä¸‰ä¸ªä¸è§£å¯†æœ‰å…³ï¼Œæ”¾åœ¨å¦ä¸€ä¸ªå¤§ç« èŠ‚è®²ã€‚<br>ç¬¬äºŒä¸ªæŠ¥é”™åªéœ€è¦åœ¨ BoardConfig.mk ä¸­æ·»åŠ </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Tool</span></span><br><span class="line">TW_INCLUDE_RESETPROP := true</span><br><span class="line">TW_INCLUDE_LIBRESETPROP := true</span><br></pre></td></tr></table></figure>

<p>ä¸ç”¨ç¼–è¯‘æµ‹è¯•ç›´æ¥ç§’æ€</p>
<h5 id="ä¿®å¤æŒ‚è½½"><a href="#ä¿®å¤æŒ‚è½½" class="headerlink" title="ä¿®å¤æŒ‚è½½"></a>ä¿®å¤æŒ‚è½½</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:Unknown File System:&#x27;/mi_ext&#x27;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€ recovery&#x2F;root&#x2F;system&#x2F;etc ä¸­çš„ recovery.fstabï¼Œå‘ç°é‡Œé¢æœ‰å¾ˆå¤šç©ºæ ¼ï¼Œæˆ‘ä»¬å…ˆå°†å®ƒæ ¼å¼åŒ–ä¸€ä¸‹ï¼Œæœ‰å®åŠ›çš„å¯ä»¥æŠŠåé¢çš„ flag ä¹Ÿå¯¹é½æ•´ç†å¥½ã€‚<br>æˆ‘æ¯”è¾ƒæ²¡å®åŠ›ï¼Œç®€å•æ ¼å¼åŒ–äº†ä¸€ä¸‹ï¼Œæ˜¯è¿™æ ·çš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br><span class="line"># 1 &quot;&lt;built-in&gt;&quot; 1</span><br><span class="line"># 1 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="line"># 341 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="line"># 1 &quot;&lt;command line&gt;&quot; 1</span><br><span class="line"># 1 &quot;&lt;built-in&gt;&quot; 2</span><br><span class="line"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot; 2</span><br><span class="line"># 173 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br><span class="line">system /system erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/avb/q-gsi.avbpubkey:/avb/r-gsi.avbpubkey:/avb/s-gsi.avbpubkey</span><br><span class="line">system /system ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/avb/q-gsi.avbpubkey:/avb/r-gsi.avbpubkey:/avb/s-gsi.avbpubkey</span><br><span class="line">vendor /vendor erofs ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">vendor /vendor ext4 ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">product /product erofs ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">product /product ext4 ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">mi_ext /mnt/vendor/mi_ext erofs ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail</span><br><span class="line">mi_ext /mnt/vendor/mi_ext ext4 ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail</span><br><span class="line">/mnt/vendor/mi_ext /mi_ext none ro,bind wait,nofail</span><br><span class="line">overlay /product/overlay overlay ro,lowerdir=/mnt/vendor/mi_ext/product/overlay/:/product/overlay check,nofail</span><br><span class="line">overlay /product/app overlay ro,lowerdir=/mnt/vendor/mi_ext/product/app/:/product/app check,nofail</span><br><span class="line">overlay /product/priv-app overlay ro,lowerdir=/mnt/vendor/mi_ext/product/priv-app/:/product/priv-app check,nofail</span><br><span class="line">overlay /product/lib overlay ro,lowerdir=/mnt/vendor/mi_ext/product/lib/:/product/lib check,nofail</span><br><span class="line">overlay /product/lib64 overlay ro,lowerdir=/mnt/vendor/mi_ext/product/lib64/:/product/lib64 check,nofail</span><br><span class="line">overlay /product/bin overlay ro,lowerdir=/mnt/vendor/mi_ext/product/bin/:/product/bin check,nofail</span><br><span class="line">overlay /product/framework overlay ro,lowerdir=/mnt/vendor/mi_ext/product/framework/:/product/framework check,nofail</span><br><span class="line">overlay /product/media overlay ro,lowerdir=/mnt/vendor/mi_ext/product/media/:/product/media check,nofail</span><br><span class="line">overlay /product/opcust overlay ro,lowerdir=/mnt/vendor/mi_ext/product/opcust/:/product/opcust check,nofail</span><br><span class="line">overlay /product/data-app overlay ro,lowerdir=/mnt/vendor/mi_ext/product/data-app/:/product/data-app check,nofail</span><br><span class="line">overlay /product/etc/sysconfig overlay ro,lowerdir=/mnt/vendor/mi_ext/product/etc/sysconfig/:/product/etc/sysconfig check,nofail</span><br><span class="line">overlay /product/etc/permissions overlay ro,lowerdir=/mnt/vendor/mi_ext/product/etc/permissions/:/product/etc/permissions check,nofail</span><br><span class="line">overlay /system/app overlay ro,lowerdir=/mnt/vendor/mi_ext/system/app/:/product/pangu/system/app/:/system/app check,nofail</span><br><span class="line">overlay /system/priv-app overlay ro,lowerdir=/mnt/vendor/mi_ext/system/priv-app/:/product/pangu/system/priv-app/:/system/priv-app check,nofail</span><br><span class="line">overlay /system/framework overlay ro,lowerdir=/product/pangu/system/framework/:/system/framework check,nofail</span><br><span class="line">overlay /system/etc/sysconfig overlay ro,lowerdir=/mnt/vendor/mi_ext/system/etc/sysconfig/:/system/etc/sysconfig check,nofail</span><br><span class="line">overlay /system/etc/permissions overlay ro,lowerdir=/mnt/vendor/mi_ext/system/etc/permissions/:/product/pangu/system/etc/permissions/:/system/etc/permissions check,nofail</span><br><span class="line">system_ext /system_ext erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/avb/q-gsi.avbpubkey:/avb/r-gsi.avbpubkey:/avb/s-gsi.avbpubkey</span><br><span class="line">system_ext /system_ext ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/avb/q-gsi.avbpubkey:/avb/r-gsi.avbpubkey:/avb/s-gsi.avbpubkey</span><br><span class="line">odm /odm erofs ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">odm /odm ext4 ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">vendor_dlkm /vendor_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">odm_dlkm /odm_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">/dev/block/by-name/metadata /metadata ext4 noatime,nosuid,nodev,discard wait,check,formattable,first_stage_mount</span><br><span class="line">/dev/block/by-name/userdata /data f2fs noatime,nosuid,nodev,discard,noflush_merge,fsync_mode=nobarrier,reserve_root=134217,resgid=1065,checkpoint_merge,gc_merge,inlinecrypt wait,check,formattable,quota,latemount,resize,reservedsize=128m,checkpoint=fs,fileencryption=aes-256-xts:aes-256-cts:v2+inlinecrypt_optimized,keydirectory=/metadata/vold/metadata_encryption,fsverity</span><br><span class="line">/dev/block/by-name/rescue /cache ext4 noatime,nosuid,nodev,noauto_da_alloc,discard wait,check,formattable</span><br><span class="line">/dev/block/by-name/protect1 /mnt/vendor/protect_f ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=1,nodelalloc wait,check,formattable</span><br><span class="line">/dev/block/by-name/protect2 /mnt/vendor/protect_s ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=1,nodelalloc wait,check,formattable</span><br><span class="line">/dev/block/by-name/nvdata /mnt/vendor/nvdata ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=1,nodelalloc wait,check,formattable</span><br><span class="line">/dev/block/by-name/nvcfg /mnt/vendor/nvcfg ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=1,nodelalloc wait,check,formattable</span><br><span class="line">/dev/block/by-name/persist /mnt/vendor/persist ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=1,nodelalloc wait,check,formattable</span><br><span class="line">/devices/platform/soc/11240000.mmc* auto auto defaults voldmanaged=sdcard1:auto,encryptable=userdata</span><br><span class="line">/devices/platform/usb_xhci* auto vfat defaults voldmanaged=usbotg:auto</span><br><span class="line">/devices/platform/soc/11201000.usb0/11200000.xhci* auto vfat defaults voldmanaged=usbotg:auto</span><br><span class="line">/dev/block/by-name/frp /persistent emmc defaults defaults</span><br><span class="line">/dev/block/by-name/nvram /nvram emmc defaults defaults</span><br><span class="line">/dev/block/by-name/proinfo /proinfo emmc defaults defaults</span><br><span class="line">/dev/block/by-name/lk /bootloader emmc defaults defaults</span><br><span class="line">/dev/block/by-name/lk2 /bootloader2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/para /para emmc defaults defaults</span><br><span class="line">/dev/block/by-name/misc /misc emmc defaults defaults</span><br><span class="line">/dev/block/by-name/boot /boot emmc defaults first_stage_mount,nofail,slotselect</span><br><span class="line">/dev/block/by-name/vbmeta_vendor /vbmeta_vendor emmc defaults first_stage_mount,nofail,slotselect</span><br><span class="line">/dev/block/by-name/vbmeta_system /vbmeta_system emmc defaults first_stage_mount,nofail,slotselect,avb=vbmeta</span><br><span class="line">/dev/block/by-name/logo /logo emmc defaults defaults</span><br><span class="line">/dev/block/by-name/expdb /expdb emmc defaults defaults</span><br><span class="line">/dev/block/by-name/seccfg /seccfg emmc defaults defaults</span><br><span class="line">/dev/block/by-name/tee1 /tee1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/tee2 /tee2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/scp1 /scp1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/scp2 /scp2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/sspm_1 /sspm_1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/sspm_2 /sspm_2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/dpm_1 /dpm_1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/dpm_2 /dpm_2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/mcupm_1 /mcupm_1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/mcupm_2 /mcupm_2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/md1img /md1img emmc defaults defaults</span><br><span class="line">/dev/block/by-name/md1dsp /md1dsp emmc defaults defaults</span><br><span class="line">/dev/block/by-name/md1arm7 /md1arm7 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/md3img /md3img emmc defaults defaults</span><br><span class="line">/dev/block/by-name/gz1 /gz1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/gz2 /gz2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/spmfw /spmfw emmc defaults defaults</span><br><span class="line">/dev/block/by-name/audio_dsp /audio_dsp emmc defaults defaults</span><br><span class="line">/dev/block/by-name/pi_img /pi_img emmc defaults defaults</span><br><span class="line">/dev/block/by-name/boot_para /boot_para emmc defaults defaults</span><br><span class="line">/dev/block/by-name/odmdtbo /odmdtbo emmc defaults defaults</span><br><span class="line">/dev/block/by-name/dtbo /dtbo emmc defaults defaults</span><br><span class="line">/dev/block/by-name/otp /otp emmc defaults defaults</span><br><span class="line">/dev/block/by-name/vbmeta /vbmeta emmc defaults defaults</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé¢æœ‰å¾ˆå¤šæ— ç”¨åˆ†åŒºï¼Œæˆ‘ä»¬åœ¨ twrp ä¸­æ“ä½œä¸åˆ°ï¼Œä½†æ˜¯æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡é€‚é… MTK è®¾å¤‡ï¼Œæ‰€ä»¥ä¸â€œçè¯´â€è¯¯äººå­å¼Ÿäº†ï¼Œå…ˆæŠŠ bug ä¿®å¥½ã€‚<br>åƒ xiaomi è¿™æ ·å¸¸è§çš„æŒ‚è½½é”™è¯¯ï¼Œæˆ‘è‡ªå·±ä¸€èˆ¬éƒ½æ˜¯å°è¯•æŠŠ&#x2F;mnt&#x2F;vendor ä½¿ç”¨ vscode å…¨éƒ¨åˆ é™¤ï¼Œè®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚å¹¶ä¸”è¦æŠŠè¿™ä¸€è¡Œåˆ é™¤ï¼Œè¿™è¡Œåœ¨æˆ‘çœ‹æ¥æ˜¯é‡å¤å®šä¹‰ï¼ˆï¼Ÿè€Œä¸”ä¹Ÿæ²¡æŒ‡å®šåˆ†åŒºæ ¼å¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/mnt/vendor/mi_ext /mi_ext none ro,bind wait,nofail</span><br></pre></td></tr></table></figure>

<p>æ•´ç†å®Œä¹‹åæ˜¯è¿™æ ·çš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br><span class="line"># 1 &quot;&lt;built-in&gt;&quot; 1</span><br><span class="line"># 1 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="line"># 341 &quot;&lt;built-in&gt;&quot; 3</span><br><span class="line"># 1 &quot;&lt;command line&gt;&quot; 1</span><br><span class="line"># 1 &quot;&lt;built-in&gt;&quot; 2</span><br><span class="line"># 1 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot; 2</span><br><span class="line"># 173 &quot;vendor/mediatek/proprietary/hardware/fstab/mt6895/fstab.in.mt6895&quot;</span><br><span class="line">system /system erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/avb/q-gsi.avbpubkey:/avb/r-gsi.avbpubkey:/avb/s-gsi.avbpubkey</span><br><span class="line">system /system ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/avb/q-gsi.avbpubkey:/avb/r-gsi.avbpubkey:/avb/s-gsi.avbpubkey</span><br><span class="line">vendor /vendor erofs ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">vendor /vendor ext4 ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">product /product erofs ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">product /product ext4 ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">mi_ext /mi_ext erofs ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail</span><br><span class="line">mi_ext /mi_ext ext4 ro wait,slotselect,avb=vbmeta,logical,first_stage_mount,nofail</span><br><span class="line">overlay /product/overlay overlay ro,lowerdir=/mi_ext/product/overlay/:/product/overlay check,nofail</span><br><span class="line">overlay /product/app overlay ro,lowerdir=/mi_ext/product/app/:/product/app check,nofail</span><br><span class="line">overlay /product/priv-app overlay ro,lowerdir=/mi_ext/product/priv-app/:/product/priv-app check,nofail</span><br><span class="line">overlay /product/lib overlay ro,lowerdir=/mi_ext/product/lib/:/product/lib check,nofail</span><br><span class="line">overlay /product/lib64 overlay ro,lowerdir=/mi_ext/product/lib64/:/product/lib64 check,nofail</span><br><span class="line">overlay /product/bin overlay ro,lowerdir=/mi_ext/product/bin/:/product/bin check,nofail</span><br><span class="line">overlay /product/framework overlay ro,lowerdir=/mi_ext/product/framework/:/product/framework check,nofail</span><br><span class="line">overlay /product/media overlay ro,lowerdir=/mi_ext/product/media/:/product/media check,nofail</span><br><span class="line">overlay /product/opcust overlay ro,lowerdir=/mi_ext/product/opcust/:/product/opcust check,nofail</span><br><span class="line">overlay /product/data-app overlay ro,lowerdir=/mi_ext/product/data-app/:/product/data-app check,nofail</span><br><span class="line">overlay /product/etc/sysconfig overlay ro,lowerdir=/mi_ext/product/etc/sysconfig/:/product/etc/sysconfig check,nofail</span><br><span class="line">overlay /product/etc/permissions overlay ro,lowerdir=/mi_ext/product/etc/permissions/:/product/etc/permissions check,nofail</span><br><span class="line">overlay /system/app overlay ro,lowerdir=/mi_ext/system/app/:/product/pangu/system/app/:/system/app check,nofail</span><br><span class="line">overlay /system/priv-app overlay ro,lowerdir=/mi_ext/system/priv-app/:/product/pangu/system/priv-app/:/system/priv-app check,nofail</span><br><span class="line">overlay /system/framework overlay ro,lowerdir=/product/pangu/system/framework/:/system/framework check,nofail</span><br><span class="line">overlay /system/etc/sysconfig overlay ro,lowerdir=/mi_ext/system/etc/sysconfig/:/system/etc/sysconfig check,nofail</span><br><span class="line">overlay /system/etc/permissions overlay ro,lowerdir=/mi_ext/system/etc/permissions/:/product/pangu/system/etc/permissions/:/system/etc/permissions check,nofail</span><br><span class="line">system_ext /system_ext erofs ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/avb/q-gsi.avbpubkey:/avb/r-gsi.avbpubkey:/avb/s-gsi.avbpubkey</span><br><span class="line">system_ext /system_ext ext4 ro wait,slotselect,avb=vbmeta_system,logical,first_stage_mount,avb_keys=/avb/q-gsi.avbpubkey:/avb/r-gsi.avbpubkey:/avb/s-gsi.avbpubkey</span><br><span class="line">odm /odm erofs ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">odm /odm ext4 ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">vendor_dlkm /vendor_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">odm_dlkm /odm_dlkm erofs ro wait,slotselect,avb,logical,first_stage_mount</span><br><span class="line">/dev/block/by-name/metadata /metadata ext4 noatime,nosuid,nodev,discard wait,check,formattable,first_stage_mount</span><br><span class="line">/dev/block/by-name/userdata /data f2fs noatime,nosuid,nodev,discard,noflush_merge,fsync_mode=nobarrier,reserve_root=134217,resgid=1065,checkpoint_merge,gc_merge,inlinecrypt wait,check,formattable,quota,latemount,resize,reservedsize=128m,checkpoint=fs,fileencryption=aes-256-xts:aes-256-cts:v2+inlinecrypt_optimized,keydirectory=/metadata/vold/metadata_encryption,fsverity</span><br><span class="line">/dev/block/by-name/rescue /cache ext4 noatime,nosuid,nodev,noauto_da_alloc,discard wait,check,formattable</span><br><span class="line">/dev/block/by-name/protect1 /protect_f ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=1,nodelalloc wait,check,formattable</span><br><span class="line">/dev/block/by-name/protect2 /protect_s ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=1,nodelalloc wait,check,formattable</span><br><span class="line">/dev/block/by-name/nvdata /nvdata ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=1,nodelalloc wait,check,formattable</span><br><span class="line">/dev/block/by-name/nvcfg /nvcfg ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=1,nodelalloc wait,check,formattable</span><br><span class="line">/dev/block/by-name/persist /persist ext4 noatime,nosuid,nodev,noauto_da_alloc,commit=1,nodelalloc wait,check,formattable</span><br><span class="line">/devices/platform/soc/11240000.mmc* auto auto defaults voldmanaged=sdcard1:auto,encryptable=userdata</span><br><span class="line">/devices/platform/usb_xhci* auto vfat defaults voldmanaged=usbotg:auto</span><br><span class="line">/devices/platform/soc/11201000.usb0/11200000.xhci* auto vfat defaults voldmanaged=usbotg:auto</span><br><span class="line">/dev/block/by-name/frp /persistent emmc defaults defaults</span><br><span class="line">/dev/block/by-name/nvram /nvram emmc defaults defaults</span><br><span class="line">/dev/block/by-name/proinfo /proinfo emmc defaults defaults</span><br><span class="line">/dev/block/by-name/lk /bootloader emmc defaults defaults</span><br><span class="line">/dev/block/by-name/lk2 /bootloader2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/para /para emmc defaults defaults</span><br><span class="line">/dev/block/by-name/misc /misc emmc defaults defaults</span><br><span class="line">/dev/block/by-name/boot /boot emmc defaults first_stage_mount,nofail,slotselect</span><br><span class="line">/dev/block/by-name/vbmeta_vendor /vbmeta_vendor emmc defaults first_stage_mount,nofail,slotselect</span><br><span class="line">/dev/block/by-name/vbmeta_system /vbmeta_system emmc defaults first_stage_mount,nofail,slotselect,avb=vbmeta</span><br><span class="line">/dev/block/by-name/logo /logo emmc defaults defaults</span><br><span class="line">/dev/block/by-name/expdb /expdb emmc defaults defaults</span><br><span class="line">/dev/block/by-name/seccfg /seccfg emmc defaults defaults</span><br><span class="line">/dev/block/by-name/tee1 /tee1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/tee2 /tee2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/scp1 /scp1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/scp2 /scp2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/sspm_1 /sspm_1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/sspm_2 /sspm_2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/dpm_1 /dpm_1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/dpm_2 /dpm_2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/mcupm_1 /mcupm_1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/mcupm_2 /mcupm_2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/md1img /md1img emmc defaults defaults</span><br><span class="line">/dev/block/by-name/md1dsp /md1dsp emmc defaults defaults</span><br><span class="line">/dev/block/by-name/md1arm7 /md1arm7 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/md3img /md3img emmc defaults defaults</span><br><span class="line">/dev/block/by-name/gz1 /gz1 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/gz2 /gz2 emmc defaults defaults</span><br><span class="line">/dev/block/by-name/spmfw /spmfw emmc defaults defaults</span><br><span class="line">/dev/block/by-name/audio_dsp /audio_dsp emmc defaults defaults</span><br><span class="line">/dev/block/by-name/pi_img /pi_img emmc defaults defaults</span><br><span class="line">/dev/block/by-name/boot_para /boot_para emmc defaults defaults</span><br><span class="line">/dev/block/by-name/odmdtbo /odmdtbo emmc defaults defaults</span><br><span class="line">/dev/block/by-name/dtbo /dtbo emmc defaults defaults</span><br><span class="line">/dev/block/by-name/otp /otp emmc defaults defaults</span><br><span class="line">/dev/block/by-name/vbmeta /vbmeta emmc defaults defaults</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬ç¼–è¯‘è¯•ä¸€ä¸‹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œtwrp æ¯æ¬¡æ›´æ”¹æœ€å¥½åˆ é™¤ out é‡æ–°ç¼–è¯‘ï¼Œä¸è¦ä½¿ç”¨å¦‚<code>make installclean</code>ç­‰å‘½ä»¤ï¼Œå¯èƒ½ä¼šå¼€æœºé»‘å±æˆ–æ›´æ”¹ä¸ç”Ÿæ•ˆã€‚<br>ç»è¿‡ä¸€åˆ†é’Ÿï¼Œç¼–è¯‘å¥½äº†ï¼Œåˆ·å…¥ï¼Œå¼€æœºï¼Œå¯åŠ¨ï¼å¯ä»¥çœ‹è§æŒ‚è½½æˆåŠŸè¢«ä¿®å¥½ã€‚</p>
<h5 id="ä¿®å¤å±å¹•æ˜¾ç¤º"><a href="#ä¿®å¤å±å¹•æ˜¾ç¤º" class="headerlink" title="ä¿®å¤å±å¹•æ˜¾ç¤º"></a>ä¿®å¤å±å¹•æ˜¾ç¤º</h5><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç°åœ¨å±å¹•çš„é¡¶éƒ¨çš„æ—¶é—´è¢«æ‘„åƒå¤´æŒ–å­”æŒ¡ä½äº†ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªåç§» Flag æ¥ä¿®å¤å®ƒã€‚<br>åœ¨ BoardConfig.mk ä¸­ï¼ŒåŠ å…¥ä»¥ä¸‹ flag</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TW_Y_OFFSET := 106 <span class="comment">#å¯¼èˆªæ å‘ä¸Š</span></span><br><span class="line">TW_H_OFFSET := -106 <span class="comment">#ç•Œé¢æ•´ä½“å‘ä¸‹</span></span><br></pre></td></tr></table></figure>

<h5 id="ä¿®å¤æŒ¯åŠ¨"><a href="#ä¿®å¤æŒ¯åŠ¨" class="headerlink" title="ä¿®å¤æŒ¯åŠ¨"></a>ä¿®å¤æŒ¯åŠ¨</h5><blockquote>
<p>ä»…ä¾›å‚è€ƒï¼Œç ”ç©¶åŠå¤©å‘ç°åªæœ‰è§£å¯†åŠŸèƒ½æ­£å¸¸æ‰èƒ½ä¿®æŒ¯åŠ¨ï¼Œä¸ç„¶ä¼šå†»å±ï¼ï¼ï¼<br>ä¸ä¸€å®šæ­£ç¡®ï¼Œä¹Ÿä¸ä¸€å®šæ™®éï¼Œä»…ä¾›æŒ‡è·¯</p>
</blockquote>
<p>è€è®¾å¤‡ä¸€èˆ¬éƒ½æ˜¯æ­£å¸¸çš„ï¼Œä¸éœ€è¦é¢å¤–å¤„ç†ï¼Œæ–°è®¾å¤‡ä½¿ç”¨ aidl hal éœ€è¦æˆ‘ä»¬è‡ªå·±å¤„ç†ä¸€ä¸‹è®© service æ­£å¸¸å·¥ä½œã€‚<br>æŒ‚è½½ vendorï¼Œä½¿ç”¨ twrp çš„æ–‡ä»¶ç®¡ç†ï¼Œåœ¨ vendor&#x2F;etc&#x2F;vintf&#x2F;manifest æ‰¾åˆ°å«æœ‰ vibrator å­—æ ·çš„æ–‡ä»¶ã€‚æ‰“å¼€ä¹‹åæ£€æŸ¥æ˜¯å¦ç±»ä¼¼è¿™æ ·çš„æ–‡æ®µ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest version=&quot;1.0&quot; type=&quot;device&quot;&gt;</span><br><span class="line">    &lt;hal format=&quot;aidl&quot; override=&quot;true&quot;&gt;</span><br><span class="line">        &lt;name&gt;android.hardware.vibrator&lt;/name&gt;</span><br><span class="line">        &lt;fqname&gt;IVibrator/vibratorfeature&lt;/fqname&gt;</span><br><span class="line">    &lt;/hal&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>

<p>é‚£æ­å–œä½ ï¼Œæ‰¾å¯¹äº†ï¼Œæˆ‘çš„æ–‡ä»¶åæ˜¯<br><code>vendor.xiaomi.hardware.vibratorfeature.service.xml</code><br>å°†å®ƒä½¿ç”¨<code>adb pull</code>æ”¾åˆ°ç”µè„‘ä¸Šè‡ªå·±æ–¹ä¾¿çš„ä½ç½®å¤‡ç”¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /vendor/etc/vintf/manifest/vendor.xiaomi.hardware.vibratorfeature.service.xml .</span><br><span class="line">/vendor/etc/vintf/manifest/vendor.xiao...ipped. 0.2 MB/s (1718 bytes in 0.009s)</span><br></pre></td></tr></table></figure>

<p>ä¸çœ‹æ‰©å±•åï¼Œåˆ° vendor&#x2F;bin&#x2F;hw&#x2F;æ‰¾åˆ°åŒåçš„ service åŒæ ·åˆ©ç”¨<code>adb pull</code>æ”¾ç”µè„‘å¤‡ç”¨ã€‚æ¯”å¦‚æˆ‘çš„å«<br><code>vendor.xiaomi.hardware.vibratorfeature.service</code><br>ç„¶ååˆ° vendor&#x2F;etc&#x2F;init&#x2F;æ‰¾åˆ°åŒå.rc æ–‡ä»¶ï¼Œæ‹‰åˆ°ç”µè„‘ä¸Šï¼Œåœ¨é‡Œé¢åŠ ä¸€æ¡ã€‚å¹¶åœ¨å®šä¹‰ service çš„æœ€ä¸‹é¢åŠ ä¸Š<code>seclabel u:r:recovery:s0</code>å¯ä»¥è¢« recovery ä½¿ç”¨ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">on boot</span><br><span class="line">    start serviceè¢«å®šä¹‰çš„åå­—</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">on post-fs-data</span><br><span class="line">    chown system system /sys/bus/i2c/drivers/aw8697_haptic/2-005a/f0_save</span><br><span class="line">    chown system system /sys/bus/i2c/drivers/aw8697_haptic/2-005a/osc_save</span><br><span class="line">    chown system system /sys/bus/i2c/drivers/aw8697_haptic/3-005a/osc_save</span><br><span class="line">    # çœç•¥ä¸€ä¸‡å­—</span><br><span class="line"></span><br><span class="line">on boot</span><br><span class="line">    start vibratorfeature-hal-service</span><br><span class="line"></span><br><span class="line">service vibratorfeature-hal-service /vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service</span><br><span class="line">    class hal</span><br><span class="line">    user system</span><br><span class="line">    group system input</span><br><span class="line">    onrestart restart vibratorfeature</span><br><span class="line">    seclabel u:r:recovery:s0</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤–è¿™ç§æ–°è®¾å¤‡åœ¨å†…æ ¸é‡Œè¿˜æœ‰æŒ¯åŠ¨æ¨¡å—éœ€è¦åŠ è½½ï¼Œè¯·åˆ°&#x2F;vendor&#x2F;modules&#x2F;1.1&#x2F;ä¸­å¯»æ‰¾ï¼Œä¾‹å¦‚æˆ‘è¿™å°è®¾å¤‡æ˜¯<code>haptic.ko</code>ï¼Œç”¨ adb pull æ‹‰å–åˆ°ç”µè„‘ä¸Šï¼Œç„¶å</p>
<ul>
<li>haptic.ko â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;modules&#x2F;1.1</li>
</ul>
<p>è‡³æ­¤æ‰€æœ‰å¿…è¦çš„èµ„æ–™å°±å‡†å¤‡å¥½äº†ã€‚å¯èƒ½å¼€æœºåä»ç„¶ä¸å·¥ä½œï¼Œéœ€è¦æŠ“å– log è¡¥ç¼ºå¤±çš„ libraryï¼Œå½“ç„¶è¿™æ˜¯åè¯äº†ã€‚</p>
<p>å¼€å¹²ï¼</p>
<p>åœ¨ BoardConfig.mk ä¸­åŠ å…¥ä»¥ä¸‹ flag</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TW_SUPPORT_INPUT_AIDL_HAPTICS := true</span><br></pre></td></tr></table></figure>

<p>å°†å¤‡ç”¨æ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æ“ä½œå¤åˆ¶</p>
<ul>
<li><p>vendor.xiaomi.hardware.vibratorfeature.service.xml â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;etc&#x2F;vintf&#x2F;manifest</p>
</li>
<li><p>vendor.xiaomi.hardware.vibratorfeature.service â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;bin&#x2F;hw</p>
</li>
<li><p>vendor.xiaomi.hardware.vibratorfeature.service.rc â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;etc&#x2F;init</p>
</li>
</ul>
<p>ä¹‹åç¼–è¯‘ï¼Œåˆ·å…¥ï¼Œå¼€æœºï¼Œå–œæå†»å±â€¦â€¦<br>é—®é¢˜ä¸å¤§ï¼Œä½¿ç”¨<code>adb logcat</code>æŠ“å–æ—¥å¿—</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb logcat &gt; log.log</span><br></pre></td></tr></table></figure>

<p>æ‰“å¼€ logï¼Œæœç´¢<code>F linker</code>ã€<code>linker</code>ã€<code>library</code>ã€<code>beginning of crash</code>è¿™å‡ ä¸ªå…³é”®è¯ï¼Œæˆ‘æœç´¢ç¬¬ä¸€ä¸ªå°±å‡ºæ¥äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F linker  : CANNOT LINK EXECUTABLE &quot;/vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service&quot;: library &quot;android.hardware.vibrator-V1-ndk_platform.so&quot; not found: needed by main executable</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µæŠ¥é”™çš„æ„æ€å°±æ˜¯<code>vendor.xiaomi.hardware.vibratorfeature.service</code>æ‰¾ä¸åˆ°<code>android.hardware.vibrator-V1-ndk_platform.so</code>è¿™ä¸ªåº“ï¼Œæ‰€ä»¥æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p>
<p>æ‰“å¼€ BoardConfig.mk åŠ å…¥ä»¥ä¸‹ flag</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Library</span></span><br><span class="line">TARGET_RECOVERY_DEVICE_MODULES += \</span><br><span class="line">    android.hardware.vibrator-V1-ndk_platform.vendor</span><br><span class="line"></span><br><span class="line">TW_RECOVERY_ADDITIONAL_RELINK_LIBRARY_FILES += \</span><br><span class="line">    <span class="variable">$(TARGET_OUT_SHARED_LIBRARIES)</span>/android.hardware.vibrator-V1-ndk_platform.so</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡ç¼–è¯‘å°è¯•<br>å¼€æœºä¹‹åä¾ç„¶å†»å±ï¼Œç»§ç»­æŠ“ logï¼ŒæŸ¥æ‰¾</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F linker  : CANNOT LINK EXECUTABLE &quot;/vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service&quot;: library &quot;vendor.hardware.vibratorfeature.IVibratorExt-V1-ndk_platform.so&quot; not found: needed by main executable</span><br></pre></td></tr></table></figure>

<p><code>vendor.hardware.vibratorfeature</code>å­—æ ·å’Œæˆ‘ä»¬ä¹‹å‰å¯¼å…¥çš„æ–‡ä»¶é•¿å¾—å·®ä¸å¤šï¼Œä¸€èˆ¬éƒ½æ˜¯ä¾›åº”å•†ä¸“æœ‰æ–‡ä»¶ï¼Œæ‰€ä»¥å»è®¾å¤‡æå–ï¼Œè·¯å¾„åœ¨ vendor&#x2F;lib64 é‡Œï¼Œè™½ç„¶è®¾å¤‡å†»å±äº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨<code>adb pull</code>ç›´æ¥æ‹‰å–åˆ°ç”µè„‘ã€‚å°±åƒè¿™æ ·ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb shell mount /vendor</span><br><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /vendor/lib64/vendor.hardware.vibratorfeature.IVibratorExt-V1-ndk_platform.so .</span><br><span class="line">/vendor/lib64/vendor.hardware.vibratorfeature.IVi...led, 0 skipped. 14.7 MB/s (33552 bytes in 0.002s</span><br></pre></td></tr></table></figure>

<p>å°†è¿™ä¸ªæ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æç¤ºæ“ä½œ</p>
<ul>
<li>vendor.hardware.vibratorfeature.IVibratorExt-V1-ndk_platform.so â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;lib64</li>
</ul>
<p>ç»§ç»­ç¼–è¯‘æµ‹è¯•<br>è¿˜æ˜¯å†»å±ï¼Œç»§ç»­æŠ“ log</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F linker  : CANNOT LINK EXECUTABLE &quot;/vendor/bin/hw/vendor.xiaomi.hardware.vibratorfeature.service&quot;: library &quot;libtinyalsa.so&quot; not found: needed by main executable</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª library twrp çš„æºç ä¸­åº”è¯¥æ²¡æœ‰ï¼Œå»è®¾å¤‡æ‹¿ä¸€ä¸ª prebuilt å§</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb shell mount /system_root</span><br><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /system_root/system/lib64/libtinyalsa.so .</span><br><span class="line">/system_root/system/lib64/libtinyalsa.so: 1 file ...led, 0 skipped. 13.6 MB/s (45032 bytes in 0.003s</span><br></pre></td></tr></table></figure>

<p>å°†è¿™ä¸ªæ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æç¤ºæ“ä½œ</p>
<ul>
<li>libtinyalsa.so â€“&gt; recovery&#x2F;root&#x2F;system&#x2F;lib64</li>
</ul>
<p>ç¼–è¯‘æµ‹è¯•<br>æˆ‘è‰¹äº†ï¼Œè¿˜æ˜¯å†»å±ï¼Œè¿™æ¬¡æœé‚£å‡ ä¸ªå…³é”®è¯éƒ½æœä¸åˆ°äº†ï¼Œæœ<code>vibrator</code>çœ‹çœ‹è¿™é¬¼ä¸œè¥¿æŠ¥ä»€ä¹ˆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E vendor.xiaomi.hardware.vibratorfeature.service: fail to load lib : /vendor/lib64/libaachaptics.so</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡éƒ½ç›´æ¥ç»™è·¯å¾„äº†ï¼Œç›´æ¥æ‹¿ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb shell mount /vendor</span><br><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~/github/$/mjw î‚° adb pull /vendor/lib64/libaachaptics.so .</span><br><span class="line">/vendor/lib64/libaachaptics.so: 1 file pulled, 0 skipped. 15.8 MB/s (56232 bytes in 0.003s)</span><br></pre></td></tr></table></figure>

<p>å°†è¿™ä¸ªæ–‡ä»¶æŒ‰ç…§ä»¥ä¸‹æç¤ºæ“ä½œ</p>
<ul>
<li>libaachaptics.so â€“&gt; recovery&#x2F;root&#x2F;vendor&#x2F;lib64</li>
</ul>
<p>è‡³æ­¤åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜äº†ï¼Œä½†æ˜¯æœ‰ä¸ª flag è²Œä¼¼è¦æ“ä½œ data å†…çš„ä¸œè¥¿ï¼Œæœªè§£å¯†ä¼šå¯¼è‡´å†»å±ï¼Œæ‰€ä»¥ç­‰ä¿®å®Œè§£å¯†åå†æ¥ä¿®æŒ¯åŠ¨ã€‚</p>
<h4 id="ä¿®å¤-CPU-æ¸©åº¦"><a href="#ä¿®å¤-CPU-æ¸©åº¦" class="headerlink" title="ä¿®å¤ CPU æ¸©åº¦"></a>ä¿®å¤ CPU æ¸©åº¦</h4><p>ä½¿ç”¨<code>adb shell</code> + <code>grep</code>å‘½ä»¤åœ¨æ‰‹æœºèŠ‚ç‚¹é‡Œæœç´¢ type å…³é”®è¯ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~ î‚° adb shell &#x27;grep &quot;cp_master&quot; /sys/class/thermal/*/type&#x27;</span><br><span class="line">/sys/class/thermal/thermal_zone54/type:cp_master</span><br><span class="line">xiaolegun@xiaoleGundeMac-Pro î‚° ~ î‚° adb shell &#x27;grep &quot;cpu&quot; /sys/class/thermal/*/type&#x27;</span><br><span class="line">/sys/class/thermal/thermal_zone1/type:cpu_little1</span><br><span class="line">/sys/class/thermal/thermal_zone10/type:cpu_bigbig1</span><br><span class="line">/sys/class/thermal/thermal_zone11/type:cpu_big6</span><br><span class="line">/sys/class/thermal/thermal_zone12/type:cpu_bigbig2</span><br><span class="line">/sys/class/thermal/thermal_zone2/type:cpu_little2</span><br><span class="line">/sys/class/thermal/thermal_zone3/type:cpu_little3</span><br><span class="line">/sys/class/thermal/thermal_zone4/type:cpu_little4</span><br><span class="line">/sys/class/thermal/thermal_zone5/type:cpu_big1</span><br><span class="line">/sys/class/thermal/thermal_zone6/type:cpu_big2</span><br><span class="line">/sys/class/thermal/thermal_zone7/type:cpu_big3</span><br><span class="line">/sys/class/thermal/thermal_zone8/type:cpu_big4</span><br><span class="line">/sys/class/thermal/thermal_zone9/type:cpu_big5</span><br></pre></td></tr></table></figure>

<p>æˆ‘è¿™é‡Œé€‰ç”¨<code>cp_master</code>èŠ‚ç‚¹æ¥è¯»å–æ¸©åº¦ã€‚æˆ‘çš„èŠ‚ç‚¹è·¯å¾„ä¸º<code>/sys/class/thermal/thermal_zone54</code>åœ¨åé¢æ·»åŠ  temp æ¥è¯»å–æ¸©åº¦ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>cat</code>æ¥æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å¯ä»¥æ­£å¸¸è¯»å–æ¸©åº¦</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell &#x27;cat /sys/class/thermal/thermal_zone54/temp&#x27;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¿”å›å¦‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">28000</span><br></pre></td></tr></table></figure>

<p>è¿™ç§ç±»ä¼¼çš„æ•°å€¼ï¼Œé‚£å¤šåŠæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚<br>æˆ‘ä»¬åœ¨ BoardConfig.mk ä¸­åŠ å…¥</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TW_CUSTOM_CPU_TEMP_PATH := <span class="string">&quot;/sys/class/thermal/thermal_zone54/temp&quot;</span></span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ cpu æ¸©åº¦å°±ä¿®å¤å¥½äº†ã€‚</p>
<h2 id="ååº"><a href="#ååº" class="headerlink" title="ååº"></a>ååº</h2><p>è¿™æ˜¯æˆ‘ç© Android ä¸¤å¹´å†…ç¬¬ä¸€æ¬¡å†™å…³äº Android çš„æ–‡ç« ï¼Œå†…å®¹å’Œæªè¾å¯èƒ½ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œå†åŠ ä¸Šå¼€å­¦ç„¦è™‘ï¼Œç§Ÿæˆ¿å› ç§Ÿé‡‘å’Œæˆ¿æºä¸é¡ºåˆ©ï¼Œå†™çš„å¾ˆä¹±ï¼Œè¯·å„ä½æŒ‡æ­£ã€‚<br>è§£å¯†ç­‰æœ‰ç©ºè¡¥ï¼Œå…ˆè¡¥ä½œä¸šã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a target="_blank" rel="noopener" href="https://source.android.com/docs/setup/create/new-device?hl=zh-cn">Google - æ·»åŠ æ–°è®¾å¤‡</a></p>
<p><a target="_blank" rel="noopener" href="https://source.android.com/docs/core/ota/ab?hl=zh-cn">Google - A&#x2F;Bï¼ˆæ— ç¼ï¼‰ç³»ç»Ÿæ›´æ–°</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.lynnrin.moe/posts/ROM-bringup-guide-prebuilt/#boardconfigmk">Lynnrin - å¿«é€Ÿä¸Šæ‰‹ Android Custom ROM é€‚é… - Prebuilt Vendor</a></p>
<p><a target="_blank" rel="noopener" href="https://source.android.com/docs/core/architecture/vintf?hl=zh-cn">Google - ä¾›åº”å•†æ¥å£å¯¹è±¡</a></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree</p><p><a href="https://blog.xiaolegun.cn/post/writing-recovery-device-tree-for-new-device/">https://blog.xiaolegun.cn/post/writing-recovery-device-tree-for-new-device/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>ä½œè€…</h6><p>xiaoleGun</p></div></div><div class="level-item is-narrow"><div><h6>å‘å¸ƒäº</h6><p>2024-02-20</p></div></div><div class="level-item is-narrow"><div><h6>æ›´æ–°äº</h6><p>2024-02-20</p></div></div><div class="level-item is-narrow"><div><h6>è®¸å¯åè®®</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Android/">Android</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Ÿæ‰“èµä¸€ä¸‹ä½œè€…å§</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>æ”¯ä»˜å®</span><span class="qrcode"><img src="/img/alipay.jpg" alt="æ”¯ä»˜å®"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>å¾®ä¿¡</span><span class="qrcode"><img src="/img/wechat.png" alt="å¾®ä¿¡"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/post/Fuck-Huawei/"><span class="level-item">åä¸ºææœºæŒ‡åŒ—(å°ç™½å‘)</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">è¯„è®º</h3><div class="content" id="valine-thread"></div><script src="//cdn.jsdelivr.net/npm/leancloud-storage@3/dist/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread',
            appId: "Ou1qvpQXJbkoS36f8u6xjWiF-gzGzoHsz",
            appKey: "t4FiwzvUxbTTNwx7dQpiHE3d",
            
            avatar: "retro",
            avatarForce: false,
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            visitor: false,
            highlight: true,
            recordIP: true,
            
            
            
            enableQQ: true,
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/touxiang.png" alt="xiaoleGun"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">xiaoleGun</p><p class="is-size-6 is-block">â€œå°Šä¸¥åªåœ¨å‰‘å³°ä¹‹ä¸Šï¼ŒçœŸç†åªåœ¨å¤§ç‚®å°„ç¨‹ä¹‹ä¸­â€</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Beijing, P.R.C.</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">3</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">3</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/xiaoleGun" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/xiaoleGun"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/xiaoleGun"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-02-20T02:46:55.000Z">2024-02-20</time></p><p class="title"><a href="/post/writing-recovery-device-tree-for-new-device/">ä¸ºæ–°è®¾å¤‡ç¼–å†™Recovery device tree</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-02-19T12:37:55.000Z">2022-02-19</time></p><p class="title"><a href="/post/Fuck-Huawei/">åä¸ºææœºæŒ‡åŒ—(å°ç™½å‘)</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-15T13:37:55.000Z">2022-01-15</time></p><p class="title"><a href="/post/Project-Mushroom/">Project-Mushroom</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">äºŒæœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">æ ‡ç­¾</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GSI/"><span class="tag">GSI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROM/"><span class="tag">ROM</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">è®¢é˜…æ›´æ–°</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="è®¢é˜…"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/touxiang.png" alt="xiaoleGun&#039;Blog" height="28"></a><p class="is-size-7"><span>&copy;&nbsp;2020 - 2024 xiaoleGun</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">å…±<span id="busuanzi_value_site_uv">0</span>ä¸ªè®¿å®¢</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>